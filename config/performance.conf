# YL-AR-DGN 性能优化配置

# ============================================
# 数据库连接池配置 (YL-monitor)
# ============================================
DATABASE_POOL_SIZE=10
DATABASE_MAX_OVERFLOW=20
DATABASE_POOL_TIMEOUT=30
DATABASE_POOL_RECYCLE=3600
DATABASE_ECHO=false

# ============================================
# 缓存配置
# ============================================
# Redis缓存（推荐用于生产环境）
CACHE_TYPE=redis
CACHE_REDIS_HOST=localhost
CACHE_REDIS_PORT=6379
CACHE_REDIS_DB=0
CACHE_REDIS_PASSWORD=
CACHE_DEFAULT_TIMEOUT=300

# 本地缓存（备用方案）
# CACHE_TYPE=simple
# CACHE_DEFAULT_TIMEOUT=300

# ============================================
# 视频处理性能优化 (AR-backend)
# ============================================
# 视频缓冲区大小
VIDEO_BUFFER_SIZE=30
# 帧处理线程数
VIDEO_WORKER_THREADS=4
# 硬件加速（如果可用）
VIDEO_HWACCEL_ENABLED=true
VIDEO_HWACCEL_DEVICE=auto

# 人脸合成性能
FACE_BATCH_SIZE=1
FACE_INFERENCE_THREADS=2
FACE_MODEL_CACHE_SIZE=3

# 音频处理性能
AUDIO_BUFFER_SIZE=1024
AUDIO_PROCESSING_THREADS=2

# ============================================
# Web服务器性能 (YL-monitor)
# ============================================
# Uvicorn工作进程
UVICORN_WORKERS=4
UVICORN_WORKER_CLASS=uvicorn.workers.UvicornWorker
UVICORN_KEEPALIVE=5
UVICORN_GRACEFUL_TIMEOUT=30

# 请求限制
MAX_REQUESTS_PER_SECOND=100
MAX_CONCURRENT_REQUESTS=50

# ============================================
# 静态资源优化
# ============================================
# 静态文件缓存
STATIC_FILE_CACHE_TIMEOUT=86400
# Gzip压缩
COMPRESSION_ENABLED=true
COMPRESSION_LEVEL=6
# Brotli压缩（如果可用）
BROTLI_ENABLED=false

# CDN配置（可选）
CDN_ENABLED=false
CDN_BASE_URL=
CDN_STATIC_PATH=/static

# ============================================
# 日志性能优化
# ============================================
# 异步日志
LOG_ASYNC=true
LOG_QUEUE_SIZE=1000
# 日志级别
LOG_LEVEL=INFO
# 日志轮转
LOG_ROTATION_ENABLED=true
LOG_MAX_BYTES=10485760  # 10MB
LOG_BACKUP_COUNT=5

# ============================================
# 内存优化
# ============================================
# 垃圾回收阈值
GC_THRESHOLD=700,10,10
# 内存限制（MB）
MEMORY_LIMIT_AR_BACKEND=2048
MEMORY_LIMIT_YL_MONITOR=1024
MEMORY_LIMIT_USER_GUI=1024

# ============================================
# 网络优化
# ============================================
# TCP keepalive
TCP_KEEPALIVE=true
TCP_KEEPALIVE_IDLE=600
TCP_KEEPALIVE_INTERVAL=30
TCP_KEEPALIVE_COUNT=3

# 连接池
HTTP_CONNECTION_POOL_SIZE=20
HTTP_CONNECTION_MAX_SIZE=100
HTTP_CONNECTION_TIMEOUT=30

# ============================================
# 监控性能
# ============================================
# 指标收集间隔（秒）
METRICS_COLLECTION_INTERVAL=30
# 健康检查间隔（秒）
HEALTH_CHECK_INTERVAL=30
# 状态上报间隔（秒）
STATUS_REPORT_INTERVAL=30

# ============================================
# Docker资源限制
# ============================================
# CPU限制（核心数）
AR_BACKEND_CPU_LIMIT=2.0
YL_MONITOR_CPU_LIMIT=1.0
USER_GUI_CPU_LIMIT=1.0

# 内存限制
AR_BACKEND_MEMORY_LIMIT=2G
YL_MONITOR_MEMORY_LIMIT=1G
USER_GUI_MEMORY_LIMIT=1G

# 交换空间限制
AR_BACKEND_SWAP_LIMIT=1G
YL_MONITOR_SWAP_LIMIT=512M
USER_GUI_SWAP_LIMIT=512M

# ============================================
# 负载均衡配置（多实例部署）
# ============================================
LOAD_BALANCER_ENABLED=false
LOAD_BALANCER_TYPE=nginx
LOAD_BALANCER_ALGORITHM=round_robin

# AR-backend实例
AR_BACKEND_INSTANCES=1
AR_BACKEND_PORT_RANGE=5501-5505

# YL-monitor实例
YL_MONITOR_INSTANCES=1
YL_MONITOR_PORT_RANGE=5500-5504
