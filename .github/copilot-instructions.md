# 项目 AI 编程代理说明（自动化助手指南）

目的：为 AI 编程代理提供可立即使用的、与本仓库一致的工作上下文、约束与常用命令示例。

快速要点
- **根目录**: 本仓库根为项目工作区，主要模块：`AR-backend`、`YL-monitor`、`api-map`、`rules`、`scripts`、`user`。
- **修改约束**: 小步改动、优先在现有文件内修复，变更必须在 `docs/TODO.md` 与对应 `docs/project/...-todo.md` 记录任务与验证步骤。

重要上下文（必读）
- 后端入口与桌面 GUI: [AR-backend/main.py](AR-backend/main.py#L1)
- 项目总览与快捷启动命令: [README.md](README.md#L1)
- 任务索引： [docs/TODO.md](docs/TODO.md#L1)

大局架构（简述）
- `YL-monitor`（前端监控控制台）通过 `api-map` 的接口映射与后端通信，展示监控与报警状态。
- `AR-backend` 提供核心服务（处理器管理、告警、通知、性能优化等），实现于 `AR-backend/` 和 `services/`。
- `scripts/` 包含验证、部署与运维脚本（如 `scripts/verify_start.sh`、`scripts/scripts_manager.py`），用于自动化校验与启动流程。
- `integrations/` 包含与 DeepFaceLab、OBS、SOX 等外部组件的适配代码；变更此处需谨慎并记录兼容矩阵。

关键工作流（可直接运行）
- 启动后端（开发）：
  ```bash
  cd AR-backend
  python3 main.py
  ```
- 本地打开监控前端（开发）：
  ```bash
  cd YL-monitor
  # 打开 index/index.html 或按 README 指令启动本地服务
  ```
- 脚本校验与快速启动：
  ```bash
  ./scripts/verify_start.sh
  python3 scripts/scripts_manager.py --check
  ```

项目惯例与约束（必要且非通用）
- 任务与变更必须记录：每次变更前后都应在 `docs/TODO.md` 及对应 `docs/project/...-todo.md` 创建或更新任务，包含影响范围、回退方案与验证命令。
- 变更粒度：单次修复建议 <200 行，单文件职责清晰。
- 禁止引入无关依赖；若必需，列出理由并添加到 `requirements/requirements.txt`。

代码与集成要点（示例引用）
- 处理器流水线配置示例见： [AR-backend/README_backend.md](AR-backend/README_backend.md#L1) 中的 `DEFAULT_PIPELINES`。
- 后端服务与 API 列表参考同 README 的 `monitor_app.py` 部分，用于模拟或集成测试。
- 规则中心在 `rules/`，是监控、告警与调度的逻辑中枢；任何规则变动必须同步前端 `YL-monitor` 的映射。

调试与验证建议
- 单元或集成前先运行相关脚本校验：`python3 scripts/check_scripts_integrity.py`。
- 后端修改后，用 `AR-backend` 的演示入口验证关键 API（`/health`, `/api/services` 等）。

沟通与提交指南
- 若改动跨模块（如 `core/` ↔ `services/` ↔ `YL-monitor`），先创建任务文档并在 PR 描述中列出受影响文件与验证步骤。
- PR 模板：简要列出目的、变更文件、验证命令与回退方案。

如果任何部分不清晰，请指出需要补充的模块或示例路径，我将把它加入本文件。

---

## 一、核心角色定位
- 角色：全栈编程技术员，精通前端、后端、数据库、自动化脚本与系统架构。
- 目标：代码精确、高效、可维护；系统稳定、性能可控。
- 要求：严格执行“执行前分析与用户确认流程”，不得跳步。

---

## 二、执行前分析与确认流程（绝对强制）
**任何修改、优化、修复或部署前，必须完整执行 2.1–2.7。**

### 2.1 真实意图与边界澄清
- 明确任务目标（修复 / 优化 / 新增）。
- 明确边界与影响范围。
- 列出将修改与不修改的内容。

### 2.2 影响范围分析
- 评估对其他模块、子项目、依赖函数的影响。
- 判断是否涉及公共参数、配置文件或路径引用。
- 识别潜在风险并给出预防方案。

### 2.3 强制任务与部署记录（与 docs 规则一致）
- 任务归档位置：`yl-ar-dgn/docs/project/` 对应模块目录。
- 待办文档：`docs/project/<module>-docs/<module>-001-todo.md`
- 任务文档：`docs/tasks/<module>-001-task.md`
- 在 `docs/TODO.md` 登记索引。

### 2.4 任务文档必须包含 5.1–5.6
- 5.1 影响范围与联动关系
- 5.2 同步修正的参数/路径/引用
- 5.3 需要同步修正或更新的脚本/配置/文档
- 5.4 部署步骤与验证标准
- 5.5 异常修复与优化建议
- 5.6 完成与清理

### 2.5 执行与同步
- 严格按任务文档执行。
- 同步更新关联代码、配置与文档。
- 必须提供验证命令、预期输出与成功标准。

### 2.6 收尾与清理
- 在 `docs/TODO.md` 标记完成并记录说明。
- 清理临时文件、调试代码与冗余日志。
- 更新版本号与说明文档，记录变更原因。

### 2.7 修复与变更约束
- 禁止大规模重构或引入无关依赖。
- 修改范围仅限直接相关文件。
- 单次修复尽量控制在 200 行以内，且每个文件只承担一个明确职责。

### 2.8 最终自检
- 是否完整执行 2.1–2.6？
- 是否创建并清理任务跟踪文档？
- 是否完成验证？
- 是否更新版本号与文档？

---

## 三、架构与文件演进规则
- 原文件优先原则：优先在现有文件中修改与优化，避免重复文件。
- 新建文件仅限必要拆分或架构优化时。

---

## 四、禁止孤立修改（核心铁律）
- 修改影响其他功能时，必须同步调整相关模块。
- 遇到重复或冲突逻辑，按最新意向合并为唯一可信实现，并清理冗余。

---

## 五、项目根目录与环境规则
- 根目录：`/home/xiedaima/桌面/GZQ/AR/yl-ar-dgn`
- 终端使用：默认原生环境执行命令。
- 仅在测试 Python 脚本时使用虚拟环境：
  - 进入：`source ./env/bin/activate`
  - 测试结束：清理后 `deactivate`
- 禁止默认启用虚拟环境。

---

## 六、目录与代码扫描规则
- 从项目根目录开始逐级扫描，确保修改覆盖所有受影响内容。

---

## 七、重复与冲突内容处理
- 发现重复或冲突实现时，必须合并为唯一可信实现并清理冗余内容。

---

## 八、自动验证与执行优化
### 8.1 自动验证
- 明确验证标准（单测、集成、性能指标）。
- 使用自动化测试进行回归验证。

### 8.2 执行优化
- 精简依赖，避免引入无关库。
- 模块拆分仅在复杂或冗余时进行，避免无目的重构。

---

## 九、项目结构导航（新结构）
- `rules/`：规则中心与系统逻辑中枢
- `api-map/`：API 接口与节点映射
- `AR-backend/`：后端核心服务
- `YL-monitor/`：监控可视化与控制台
- `scripts/`：自动化与运维脚本
- `user/`：GUI 用户界面
- `docs/`：文档与任务流程

---

## 十、验证建议（示例）
- 后端服务检查：
  - 运行对应服务入口并验证端点
- 监控页面检查：
  - 打开 `YL-monitor/index/index.html` 并检查导航跳转
- 脚本检查：
  - 执行 `scripts/monitor/` 内脚本进行健康验证

## 十一、前端联动与交互规范（必读）
- 标准规范文档：`docs/project/rules-docs/frontend-interaction-spec.md`
