# 部署任务7.1: 监控面板UI美化

**任务ID:** 7.1  
**所属阶段:** 阶段7 - 监控体系完善  
**任务名称:** 监控面板UI美化  
**优先级:** P1（重要优先级）  
**关键性:** 重要  
**预计工时:** 6小时  
**负责人:** 前端开发工程师  
**前置依赖:** 任务6.8完成  
**状态:** 待开始

---

## 一、任务目标

完善YL-monitor监控面板UI，实现响应式布局、主题配色、可视化组件和交互动效。

---

## 二、工作内容

1. 响应式布局优化
2. 主题和配色方案
3. 图标和可视化组件
4. 交互动效设计
5. 暗色/亮色模式切换

---

## 三、实施步骤

### 步骤1: 创建增强版监控面板HTML

```bash
# 创建增强版监控面板
cat > /home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/YL-monitor/templates/dashboard_enhanced.html << 'EOF'
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Live Studio - 监控中心</title>
    
    <!-- 样式库 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* 主题变量 */
        :root {
            --primary-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-dark: #1f2937;
            --bg-card: #374151;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
        }
        
        /* 亮色主题 */
        .light-theme {
            --bg-dark: #f3f4f6;
            --bg-card: #ffffff;
            --text-primary: #111827;
            --text-secondary: #6b7280;
        }
        
        /* 卡片样式 */
        .monitor-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .monitor-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }
        
        /* 状态指示器 */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            animation: pulse 2s infinite;
        }
        
        .status-online { background-color: var(--success-color); }
        .status-offline { background-color: var(--danger-color); }
        .status-warning { background-color: var(--warning-color); }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* 图表容器 */
        .chart-container {
            height: 300px;
            position: relative;
        }
        
        /* 响应式布局 */
        @media (max-width: 768px) {
            .grid-cols-4 { grid-template-columns: repeat(2, 1fr); }
            .chart-container { height: 200px; }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen">
    <!-- 顶部导航 -->
    <nav class="bg-gray-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-video text-blue-500 text-2xl mr-3"></i>
                    <span class="font-bold text-xl">AR Live Studio 监控中心</span>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- 主题切换 -->
                    <button id="theme-toggle" class="p-2 rounded-lg hover:bg-gray-700">
                        <i class="fas fa-moon"></i>
                    </button>
                    <!-- 全屏 -->
                    <button id="fullscreen-toggle" class="p-2 rounded-lg hover:bg-gray-700">
                        <i class="fas fa-expand"></i>
                    </button>
                    <!-- 设置 -->
                    <button id="settings-btn" class="p-2 rounded-lg hover:bg-gray-700">
                        <i class="fas fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区 -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- 概览卡片 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- 系统状态 -->
            <div class="monitor-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">系统状态</h3>
                    <span class="status-indicator status-online" id="system-status"></span>
                </div>
                <div class="text-3xl font-bold" id="online-nodes">0</div>
                <div class="text-sm text-gray-400">在线节点</div>
            </div>
            
            <!-- CPU使用率 -->
            <div class="monitor-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">CPU使用率</h3>
                    <i class="fas fa-microchip text-blue-500"></i>
                </div>
                <div class="text-3xl font-bold" id="cpu-usage">0%</div>
                <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                    <div class="bg-blue-500 h-2 rounded-full" id="cpu-bar" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- 内存使用率 -->
            <div class="monitor-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">内存使用率</h3>
                    <i class="fas fa-memory text-green-500"></i>
                </div>
                <div class="text-3xl font-bold" id="memory-usage">0%</div>
                <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                    <div class="bg-green-500 h-2 rounded-full" id="memory-bar" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- 告警数量 -->
            <div class="monitor-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold">活跃告警</h3>
                    <i class="fas fa-bell text-red-500"></i>
                </div>
                <div class="text-3xl font-bold text-red-500" id="active-alerts">0</div>
                <div class="text-sm text-gray-400">需要处理</div>
            </div>
        </div>

        <!-- 图表区域 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- 性能趋势图 -->
            <div class="monitor-card">
                <h3 class="text-lg font-semibold mb-4">性能趋势</h3>
                <div class="chart-container" id="performance-chart"></div>
            </div>
            
            <!-- 节点状态图 -->
            <div class="monitor-card">
                <h3 class="text-lg font-semibold mb-4">节点状态分布</h3>
                <div class="chart-container" id="nodes-chart"></div>
            </div>
        </div>

        <!-- 节点列表 -->
        <div class="monitor-card">
            <h3 class="text-lg font-semibold mb-4">节点监控</h3>
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead>
                        <tr class="border-b border-gray-600">
                            <th class="pb-3">节点名称</th>
                            <th class="pb-3">状态</th>
                            <th class="pb-3">CPU</th>
                            <th class="pb-3">内存</th>
                            <th class="pb-3">最后心跳</th>
                            <th class="pb-3">操作</th>
                        </tr>
                    </thead>
                    <tbody id="nodes-table">
                        <!-- 动态填充 -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.0/echarts.min.js"></script>
    <script src="/static/js/dashboard_enhanced.js"></script>
</body>
</html>
EOF

echo "✓ 增强版监控面板HTML已创建"
```

### 步骤2: 创建JavaScript控制器

```bash
cat > /home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/YL-monitor/static/js/dashboard_enhanced.js << 'EOF'
class DashboardController {
    constructor() {
        this.charts = {};
        this.ws = null;
        this.init();
    }
    
    init() {
        this.initCharts();
        this.initWebSocket();
        this.initEventListeners();
        this.startAutoRefresh();
    }
    
    initCharts() {
        // 性能趋势图
        this.charts.performance = echarts.init(
            document.getElementById('performance-chart')
        );
        
        this.charts.performance.setOption({
            tooltip: { trigger: 'axis' },
            legend: { data: ['CPU', '内存', '网络'], textStyle: { color: '#fff' } },
            grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: [],
                axisLine: { lineStyle: { color: '#666' } }
            },
            yAxis: {
                type: 'value',
                max: 100,
                axisLine: { lineStyle: { color: '#666' } },
                splitLine: { lineStyle: { color: '#333' } }
            },
            series: [
                {
                    name: 'CPU',
                    type: 'line',
                    smooth: true,
                    data: [],
                    itemStyle: { color: '#3b82f6' },
                    areaStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: 'rgba(59, 130, 246, 0.3)' },
                            { offset: 1, color: 'rgba(59, 130, 246, 0.05)' }
                        ])
                    }
                },
                {
                    name: '内存',
                    type: 'line',
                    smooth: true,
                    data: [],
                    itemStyle: { color: '#10b981' }
                }
            ]
        });
        
        // 节点状态饼图
        this.charts.nodes = echarts.init(
            document.getElementById('nodes-chart')
        );
        
        this.charts.nodes.setOption({
            tooltip: { trigger: 'item' },
            legend: { orient: 'vertical', left: 'left', textStyle: { color: '#fff' } },
            series: [
                {
                    type: 'pie',
                    radius: ['40%', '70%'],
                    avoidLabelOverlap: false,
                    itemStyle: {
                        borderRadius: 10,
                        borderColor: '#374151',
                        borderWidth: 2
                    },
                    label: { show: false },
                    data: [
                        { value: 0, name: '在线', itemStyle: { color: '#10b981' } },
                        { value: 0, name: '离线', itemStyle: { color: '#ef4444' } },
                        { value: 0, name: '警告', itemStyle: { color: '#f59e0b' } }
                    ]
                }
            ]
        });
    }
    
    initWebSocket() {
        this.ws = new WebSocket('ws://localhost:5000/ws/metrics');
        
        this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            this.updateDashboard(data);
        };
        
        this.ws.onclose = () => {
            console.log('WebSocket连接关闭，5秒后重连...');
            setTimeout(() => this.initWebSocket(), 5000);
        };
    }
    
    updateDashboard(data) {
        // 更新概览卡片
        document.getElementById('online-nodes').textContent = data.online_count;
        document.getElementById('cpu-usage').textContent = data.cpu_percent + '%';
        document.getElementById('memory-usage').textContent = data.memory_percent + '%';
        document.getElementById('active-alerts').textContent = data.active_alerts;
        
        // 更新进度条
        document.getElementById('cpu-bar').style.width = data.cpu_percent + '%';
        document.getElementById('memory-bar').style.width = data.memory_percent + '%';
        
        // 更新图表
        this.updateCharts(data);
        
        // 更新节点列表
        this.updateNodesTable(data.nodes);
    }
    
    updateCharts(data) {
        // 更新性能趋势图
        const now = new Date().toLocaleTimeString();
        const option = this.charts.performance.getOption();
        
        option.xAxis[0].data.push(now);
        option.series[0].data.push(data.cpu_percent);
        option.series[1].data.push(data.memory_percent);
        
        // 保持最近20个数据点
        if (option.xAxis[0].data.length > 20) {
            option.xAxis[0].data.shift();
            option.series[0].data.shift();
            option.series[1].data.shift();
        }
        
        this.charts.performance.setOption(option);
        
        // 更新节点状态饼图
        this.charts.nodes.setOption({
            series: [{
                data: [
                    { value: data.online_count, name: '在线' },
                    { value: data.offline_count, name: '离线' },
                    { value: data.warning_count, name: '警告' }
                ]
            }]
        });
    }
    
    updateNodesTable(nodes) {
        const tbody = document.getElementById('nodes-table');
        tbody.innerHTML = nodes.map(node => `
            <tr class="border-b border-gray-700 hover:bg-gray-700">
                <td class="py-3">${node.name}</td>
                <td class="py-3">
                    <span class="status-indicator status-${node.status}"></span>
                    ${node.status}
                </td>
                <td class="py-3">${node.cpu_percent}%</td>
                <td class="py-3">${node.memory_percent}%</td>
                <td class="py-3">${new Date(node.last_heartbeat).toLocaleString()}</td>
                <td class="py-3">
                    <button onclick="viewNode('${node.id}')" class="text-blue-500 hover:text-blue-400">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button onclick="restartNode('${node.id}')" class="text-yellow-500 hover:text-yellow-400 ml-2">
                        <i class="fas fa-redo"></i>
                    </button>
                </td>
            </tr>
        `).join('');
    }
    
    initEventListeners() {
        // 主题切换
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
        });
        
        // 全屏切换
        document.getElementById('fullscreen-toggle').addEventListener('click', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });
        
        // 窗口大小改变时重绘图表
        window.addEventListener('resize', () => {
            Object.values(this.charts).forEach(chart => chart.resize());
        });
    }
    
    startAutoRefresh() {
        // 每30秒刷新一次数据
        setInterval(() => {
            fetch('/api/metrics/summary')
                .then(res => res.json())
                .then(data => this.updateDashboard(data));
        }, 30000);
    }
}

// 初始化
document.addEventListener('DOMContentLoaded', () => {
    window.dashboard = new DashboardController();
});
EOF

echo "✓ JavaScript控制器已创建"
```

### 步骤3: 验证UI实现

```bash
cat > /tmp/verify_ui.sh << 'EOF'
#!/bin/bash
echo "========================================"
echo "UI美化验证"
echo "========================================"

errors=0

# 检查HTML文件
echo -n "检查HTML文件... "
if [ -f "/home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/YL-monitor/templates/dashboard_enhanced.html" ]; then
    echo "✓ 通过"
else
    echo "✗ 失败"
    errors=$((errors + 1))
fi

# 检查JS文件
echo -n "检查JS文件... "
if [ -f "/home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/YL-monitor/static/js/dashboard_enhanced.js" ]; then
    echo "✓ 通过"
else
    echo "✗ 失败"
    errors=$((errors + 1))
fi

echo "========================================"
if [ $errors -eq 0 ]; then
    echo "✓ UI美化验证通过"
    exit 0
else
    echo "✗ UI美化验证失败 ($errors 个错误)"
    exit 1
fi
EOF

chmod +x /tmp/verify_ui.sh
/tmp/verify_ui.sh
```

---

## 四、验证步骤

### 验证清单

- [ ] 响应式布局完成
- [ ] 主题切换功能实现
- [ ] 图表组件集成
- [ ] 交互动效实现

---

## 五、预期结果

| 指标 | 目标值 | 验证方法 |
|------|--------|----------|
| 响应式布局 | 完成 | 多设备测试 |
| 主题切换 | 功能实现 | 功能测试 |
| 图表组件 | 集成成功 | 视觉检查 |
| 交互动效 | 实现 | 交互测试 |

---

## 六、关联文档

- [任务跟踪-阶段7-监控体系完善.md](./任务跟踪-阶段7-监控体系完善.md)
- [任务跟踪-阶段7-监控体系完善-部署任务7.2-实时数据可视化.md](./任务跟踪-阶段7-监控体系完善-部署任务7.2-实时数据可视化.md)

---

**创建时间:** 2026-02-11
