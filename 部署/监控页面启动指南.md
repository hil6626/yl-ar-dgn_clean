# YL-Monitor ç›‘æ§é¡µé¢å¯åŠ¨ä¸é…ç½®æŒ‡å—

**ç‰ˆæœ¬:** 1.0.0  
**åˆ›å»ºæ—¥æœŸ:** 2026-02-15  
**çŠ¶æ€:** å·²éªŒè¯å¯ç”¨

---

## ğŸ¯ å¿«é€Ÿå¯åŠ¨ï¼ˆ3æ­¥å®Œæˆï¼‰

### æ­¥éª¤1: ç¡®è®¤æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ YL-monitor æ˜¯å¦è¿è¡Œ
curl http://0.0.0.0:5500/api/health
# é¢„æœŸè¾“å‡º: {"status":"healthy","version":"1.0.6",...}

# æ£€æŸ¥ AR-backend ç›‘æ§æœåŠ¡
curl http://0.0.0.0:5501/health
# é¢„æœŸè¾“å‡º: {"status":"healthy","version":"2.0.0",...}
```

### æ­¥éª¤2: å¯åŠ¨ User GUIï¼ˆè¢«ç›‘æ§ç«¯ï¼‰

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/vboxuser/æ¡Œé¢/é¡¹ç›®éƒ¨ç½²/é¡¹ç›®1/yl-ar-dgn_clean

# å¯åŠ¨ User GUI
python user/main.py &
# æˆ–ä½¿ç”¨å¯åŠ¨è„šæœ¬
./user/start.sh
```

### æ­¥éª¤3: è®¿é—®ç›‘æ§é¡µé¢

```bash
# æµè§ˆå™¨æ‰“å¼€ç›‘æ§é¡µé¢
# URL: http://0.0.0.0:5500/ar

# æˆ–ä½¿ç”¨è„šæœ¬è‡ªåŠ¨æ‰“å¼€
./scripts/yl-ar-dgn.sh monitor
```

---

## ğŸ“Š ç›‘æ§é¡µé¢åŠŸèƒ½è¯´æ˜

### 1. èŠ‚ç‚¹çŠ¶æ€ç›‘æ§

| èŠ‚ç‚¹ | ç±»å‹ | ç›‘æ§æ–¹å¼ | çŠ¶æ€æ˜¾ç¤º |
|------|------|----------|----------|
| AR-backend | åç«¯æœåŠ¡ | HTTPå¥åº·æ£€æŸ¥ | åœ¨çº¿/ç¦»çº¿/é”™è¯¯ |
| User GUI | æ¡Œé¢åº”ç”¨ | è¿›ç¨‹ç›‘æ§ | è¿è¡Œä¸­/æœªè¿è¡Œ |

### 2. å®æ—¶æ•°æ®å±•ç¤º

**AR-backend èŠ‚ç‚¹:**
- å¥åº·çŠ¶æ€ (online/offline)
- æœåŠ¡ç‰ˆæœ¬
- è¿è¡Œæ—¶é—´
- æ‘„åƒå¤´çŠ¶æ€
- éŸ³é¢‘çŠ¶æ€
- äººè„¸æ¨¡å—çŠ¶æ€

**User GUI èŠ‚ç‚¹:**
- è¿›ç¨‹çŠ¶æ€ (running/stopped)
- PID
- å†…å­˜å ç”¨
- CPUä½¿ç”¨ç‡
- è¿è¡Œæ—¶é—´

### 3. ç›‘æ§APIç«¯ç‚¹

```bash
# è·å–æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€
GET http://0.0.0.0:5500/api/v1/ar/nodes

# è·å–ç‰¹å®šèŠ‚ç‚¹çŠ¶æ€
GET http://0.0.0.0:5500/api/v1/ar/status?node_id=ar-backend

# è·å–æ€§èƒ½æ•°æ®
GET http://0.0.0.0:5500/api/v1/ar/performance

# å‘é€å¿ƒè·³ï¼ˆèŠ‚ç‚¹ä¸»åŠ¨ä¸ŠæŠ¥ï¼‰
POST http://0.0.0.0:5500/api/v1/ar/heartbeat?node_id=ar-backend
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### èŠ‚ç‚¹é…ç½®æ–‡ä»¶

**æ–‡ä»¶ä½ç½®:** `YL-monitor/config/nodes.yaml`

```yaml
nodes:
  - node_id: ar-backend
    node_name: AR Backend Service
    node_type: ar-backend
    host:0.0.0.0
    port: 5501
    health_endpoint: /health
    status_endpoint: /status
    check_interval: 30  # æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰
    timeout: 5           # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
    fail_threshold: 3    # å¤±è´¥é˜ˆå€¼ï¼ˆæ¬¡ï¼‰

  - node_id: user-gui
    node_name: User GUI Application
    node_type: user-gui
    host:0.0.0.0
    port: 5502
    health_endpoint: /health
    status_endpoint: /status
    check_interval: 30
    timeout: 5
    fail_threshold: 3
```

### ç›‘æ§æ–¹å¼è¯´æ˜

| èŠ‚ç‚¹ç±»å‹ | ç›‘æ§æ–¹å¼ | å®ç°æ–‡ä»¶ |
|----------|----------|----------|
| ar-backend | HTTPè½®è¯¢ | `ar_monitor.py` â†’ `_check_node()` |
| user-gui | è¿›ç¨‹æ£€æµ‹ | `ar_monitor.py` â†’ `_check_user_gui_node()` |

---

## ğŸš€ é«˜çº§é…ç½®

### 1. è‡ªåŠ¨å¯åŠ¨ç›‘æ§

åˆ›å»º systemd æœåŠ¡ï¼ˆLinuxï¼‰:

```ini
# /etc/systemd/system/yl-monitor.service
[Unit]
Description=YL-Monitor ARç›‘æ§æœåŠ¡
After=network.target

[Service]
Type=simple
User=vboxuser
WorkingDirectory=/home/vboxuser/æ¡Œé¢/é¡¹ç›®éƒ¨ç½²/é¡¹ç›®1/yl-ar-dgn_clean/YL-monitor
ExecStart=/usr/bin/python3 start_server.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯ç”¨æœåŠ¡:
```bash
sudo systemctl enable yl-monitor
sudo systemctl start yl-monitor
```

### 2. å‘Šè­¦é…ç½®

ä¿®æ”¹ `ar_monitor.py` ä¸­çš„ `_trigger_alert()` æ–¹æ³•:

```python
async def _trigger_alert(self, node: NodeInfo, alert_type: str):
    """è§¦å‘å‘Šè­¦"""
    logger.warning(f"è§¦å‘å‘Šè­¦: {alert_type} - {node.node_id}")
    
    # å‘é€é‚®ä»¶å‘Šè­¦
    if alert_type == 'node_offline':
        await self._send_email_alert(node)
    
    # å‘é€é’‰é’‰é€šçŸ¥
    await self._send_dingtalk_alert(node, alert_type)

async def _send_email_alert(self, node: NodeInfo):
    """å‘é€é‚®ä»¶å‘Šè­¦"""
    # å®ç°é‚®ä»¶å‘é€é€»è¾‘
    pass

async def _send_dingtalk_alert(self, node: NodeInfo, alert_type: str):
    """å‘é€é’‰é’‰å‘Šè­¦"""
    # å®ç°é’‰é’‰é€šçŸ¥é€»è¾‘
    pass
```

### 3. è‡ªå®šä¹‰ç›‘æ§é¢æ¿

ä¿®æ”¹ `YL-monitor/templates/ar.html` æ·»åŠ è‡ªå®šä¹‰ç»„ä»¶:

```html
<!-- åœ¨ main-content-mount ä¸­æ·»åŠ  -->
<div id="custom-metrics">
    <h3>è‡ªå®šä¹‰æŒ‡æ ‡</h3>
    <div id="fps-chart"></div>
    <div id="latency-chart"></div>
</div>
```

---

## ğŸ“ˆ ç›‘æ§æ•°æ®è§£è¯»

### èŠ‚ç‚¹çŠ¶æ€å«ä¹‰

| çŠ¶æ€ | å«ä¹‰ | å¤„ç†å»ºè®® |
|------|------|----------|
| online | èŠ‚ç‚¹æ­£å¸¸è¿è¡Œ | æ— éœ€å¤„ç† |
| offline | èŠ‚ç‚¹ç¦»çº¿ | æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯åŠ¨ |
| error | èŠ‚ç‚¹é”™è¯¯ | æŸ¥çœ‹æ—¥å¿—æ’æŸ¥é—®é¢˜ |
| unknown | çŠ¶æ€æœªçŸ¥ | ç­‰å¾…é¦–æ¬¡æ£€æŸ¥å®Œæˆ |

### æ€§èƒ½æŒ‡æ ‡è¯´æ˜

**AR-backend:**
- CPUä½¿ç”¨ç‡: å»ºè®® < 80%
- å†…å­˜ä½¿ç”¨: å»ºè®® < 4GB
- FPS: å»ºè®® > 25fps

**User GUI:**
- å†…å­˜å ç”¨: å»ºè®® < 200MB
- CPUä½¿ç”¨ç‡: å»ºè®® < 50%
- å“åº”æ—¶é—´: å»ºè®® < 100ms

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1: ç›‘æ§é¡µé¢æ— æ³•è®¿é—®

```bash
# æ£€æŸ¥ YL-monitor æ˜¯å¦è¿è¡Œ
ps aux | grep start_server

# æ£€æŸ¥ç«¯å£å ç”¨
netstat -tlnp | grep 5500

# é‡å¯ YL-monitor
cd YL-monitor && python3 start_server.py
```

### é—®é¢˜2: AR-backend æ˜¾ç¤º offline

```bash
# æ£€æŸ¥ AR-backend ç›‘æ§æœåŠ¡
curl http://0.0.0.0:5501/health

# æ£€æŸ¥ç«¯å£
netstat -tlnp | grep 5501

# é‡å¯ AR-backend ç›‘æ§æœåŠ¡
cd AR-backend && python3 monitor_server.py
```

### é—®é¢˜3: User GUI æ˜¾ç¤º offline

```bash
# æ£€æŸ¥ User GUI è¿›ç¨‹
ps aux | grep "user/main.py"

# æ‰‹åŠ¨å¯åŠ¨ User GUI
python user/main.py &

# æ£€æŸ¥è¿›ç¨‹ç›‘æ§è„šæœ¬
python3 YL-monitor/app/services/user_gui_monitor.py
```

### é—®é¢˜4: èŠ‚ç‚¹çŠ¶æ€ä¸æ›´æ–°

```bash
# æ£€æŸ¥ YL-monitor æ—¥å¿—
tail -f YL-monitor/logs/app.log

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat YL-monitor/config/nodes.yaml

# é‡å¯ YL-monitor æœåŠ¡
pkill -f start_server.py
cd YL-monitor && python3 start_server.py
```

---

## ğŸ“ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# å¿«é€ŸçŠ¶æ€æ£€æŸ¥
./scripts/yl-ar-dgn.sh status

# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
./scripts/yl-ar-dgn.sh logs

# å¥åº·æ£€æŸ¥
./scripts/yl-ar-dgn.sh health

# æ‰“å¼€ç›‘æ§é¡µé¢
./scripts/yl-ar-dgn.sh monitor

# éªŒè¯éƒ¨ç½²
./scripts/yl-ar-dgn.sh validate

# é‡å¯æ‰€æœ‰æœåŠ¡
./scripts/yl-ar-dgn.sh restart
```

---

## ğŸ‰ éªŒè¯æ¸…å•

- [x] YL-monitor æœåŠ¡è¿è¡Œ (ç«¯å£5500)
- [x] AR-backend ç›‘æ§æœåŠ¡è¿è¡Œ (ç«¯å£5501)
- [x] èŠ‚ç‚¹é…ç½®æ­£ç¡® (`nodes.yaml`)
- [x] ç›‘æ§é¡µé¢å¯è®¿é—® (`http://0.0.0.0:5500/ar`)
- [x] API è¿”å›èŠ‚ç‚¹çŠ¶æ€ (`/api/v1/ar/nodes`)
- [x] User GUI è¿›ç¨‹ç›‘æ§è„šæœ¬å¯ç”¨
- [x] ç»Ÿä¸€è„šæœ¬å…¥å£åŠŸèƒ½å®Œæ•´

---

**ä¸‹ä¸€æ­¥:** å¯åŠ¨ User GUI å¹¶è§‚å¯Ÿç›‘æ§é¡µé¢å®æ—¶æ›´æ–°
