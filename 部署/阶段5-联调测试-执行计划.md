# 阶段5：联调测试执行计划

**版本:** 1.0.0  
**创建日期:** 2026-02-16  
**状态:** 🟡 执行中

---

## 🎯 测试目标

验证 YL-AR-DGN 项目所有组件的协同工作能力：
1. **YL-monitor** (端口5500) - 监控平台
2. **AR-backend** (端口5501) - 后端服务
3. **User GUI** (端口5502) - 用户界面

---

## 📋 测试范围

### 1. 服务启动测试
- 验证所有服务能正常启动
- 验证服务启动顺序正确
- 验证服务间依赖关系

### 2. 健康检查测试
- 验证所有健康检查端点可用
- 验证健康检查返回数据正确
- 验证健康检查超时处理

### 3. 监控整合测试
- 验证 YL-monitor 能监控 AR-backend
- 验证 YL-monitor 能监控 User GUI
- 验证监控数据实时更新

### 4. API接口测试
- 验证所有API端点可用
- 验证API返回格式正确
- 验证API错误处理

### 5. 端到端流程测试
- 验证完整业务流程
- 验证数据流正确性
- 验证错误恢复机制

---

## 🚀 执行步骤

### 步骤1: 服务状态检查 (10分钟)

**操作:**
```bash
# 检查当前服务状态
./scripts/yl-ar-dgn.sh status

# 健康检查
./scripts/yl-ar-dgn.sh health

# 验证监控脚本
./scripts/verify-monitoring.sh
```

**验收标准:**
- [ ] 所有服务状态显示正常
- [ ] 健康检查全部通过
- [ ] 监控验证无错误

---

### 步骤2: API端点测试 (20分钟)

**测试端点列表:**

| 服务 | 端点 | 预期结果 |
|------|------|----------|
| YL-monitor | GET /api/health | {"status": "healthy"} |
| YL-monitor | GET /api/v1/monitor/ui/status | UI监控数据 |
| YL-monitor | GET /api/v1/monitor/infrastructure | L1基础设施监控 |
| YL-monitor | GET /api/v1/monitor/system-resources | L2系统资源监控 |
| YL-monitor | GET /api/v1/monitor/application | L3应用服务监控 |
| YL-monitor | GET /api/v1/monitor/business | L4业务功能监控 |
| YL-monitor | GET /api/v1/monitor/user-experience | L5用户体验监控 |
| AR-backend | GET /health | {"status": "healthy"} |
| AR-backend | GET /status | 详细状态 |
| AR-backend | GET /metrics | 性能指标 |
| User GUI | GET /health | {"status": "healthy"} |
| User GUI | GET /status | GUI状态 |

**操作:**
```bash
# 自动化API测试脚本
./scripts/test-api-endpoints.sh
```

**验收标准:**
- [ ] 所有端点返回200状态码
- [ ] 返回JSON格式正确
- [ ] 响应时间 < 500ms

---

### 步骤3: 监控数据流测试 (20分钟)

**测试内容:**
1. YL-monitor 能正确显示 AR-backend 状态
2. YL-monitor 能正确显示 User GUI 状态
3. 监控数据实时更新（30秒间隔）
4. 告警功能正常工作

**操作:**
```bash
# 检查监控节点
curl http://0.0.0.0:5500/api/ar/nodes

# 检查监控数据
curl http://0.0.0.0:5500/api/v1/monitor/ui/status
```

**验收标准:**
- [ ] 监控面板显示所有节点
- [ ] 节点状态实时更新
- [ ] 告警规则能触发

---

### 步骤4: 故障恢复测试 (20分钟)

**测试场景:**
1. 模拟 AR-backend 故障，验证 YL-monitor 告警
2. 模拟 User GUI 故障，验证监控检测
3. 验证服务重启后自动恢复监控

**操作:**
```bash
# 停止AR-backend
./scripts/yl-ar-dgn.sh stop ar-backend

# 检查监控状态（应显示异常）
./scripts/yl-ar-dgn.sh status

# 重启AR-backend
./scripts/yl-ar-dgn.sh start ar-backend

# 验证恢复
./scripts/yl-ar-dgn.sh health
```

**验收标准:**
- [ ] 故障能被检测
- [ ] 告警能触发
- [ ] 恢复后状态正常

---

### 步骤5: 端到端业务流程测试 (30分钟)

**测试场景:**
1. 启动所有服务
2. 验证监控面板能访问
3. 验证 User GUI 能连接 AR-backend
4. 验证数据流完整

**操作:**
```bash
# 一键启动所有服务
./start-all.sh

# 等待服务启动
sleep 5

# 验证所有服务
./check-status.sh

# 访问监控面板
./scripts/yl-ar-dgn.sh monitor
```

**验收标准:**
- [ ] 所有服务启动成功
- [ ] 监控面板可访问
- [ ] 组件间通信正常

---

## ⏱️ 时间估算

| 步骤 | 预计时间 | 实际时间 | 状态 |
|------|----------|----------|------|
| 步骤1: 服务状态检查 | 10分钟 | - | ⬜ 待开始 |
| 步骤2: API端点测试 | 20分钟 | - | ⬜ 待开始 |
| 步骤3: 监控数据流测试 | 20分钟 | - | ⬜ 待开始 |
| 步骤4: 故障恢复测试 | 20分钟 | - | ⬜ 待开始 |
| 步骤5: 端到端测试 | 30分钟 | - | ⬜ 待开始 |
| **总计** | **1小时40分钟** | - | **⬜ 待开始** |

---

## ✅ 验收标准

### 功能验收
- [ ] 所有服务能正常启动和停止
- [ ] 所有健康检查端点可用
- [ ] 所有API端点返回正确数据
- [ ] 监控数据实时更新
- [ ] 告警功能正常工作
- [ ] 故障恢复机制有效

### 性能验收
- [ ] API响应时间 < 500ms
- [ ] 监控数据更新延迟 < 30秒
- [ ] 服务启动时间 < 10秒

### 稳定性验收
- [ ] 连续运行1小时无错误
- [ ] 故障恢复后服务正常
- [ ] 无内存泄漏

---

## 📚 关联文档

- [7.联调测试方案.md](./7.联调测试方案.md) - 详细测试方案
- [阶段4完成报告](./阶段4-脚本整合-完成报告.md) - 前置阶段成果
- [scripts/SCRIPT_INVENTORY_V2.md](../scripts/SCRIPT_INVENTORY_V2.md) - 脚本清单

---

**下一步:** 开始执行步骤1 - 服务状态检查
