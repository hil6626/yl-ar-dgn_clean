# 部署任务6.7: User GUI音频处理功能验证

**任务ID:** 6.7  
**所属阶段:** 阶段6 - 核心业务功能验证  
**任务名称:** User GUI音频处理功能验证  
**优先级:** P1（重要优先级）  
**关键性:** 重要  
**预计工时:** 4小时  
**负责人:** 前端开发工程师  
**前置依赖:** 任务6.5完成  
**状态:** 待开始

---

## 一、任务目标

验证User GUI音频处理功能，确保音频源选择、音效应用、实时处理、音频输出和音视频同步功能正常。

---

## 二、工作内容

1. 音频源选择功能测试
2. 音效应用测试
3. 实时处理测试
4. 音频输出测试
5. 音视频同步测试

---

## 三、实施步骤

### 步骤1: 测试音频源选择

```bash
cat > /tmp/test_audio_source.py << 'EOF'
#!/usr/bin/env python3
import sys
sys.path.insert(0, '/home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/user')

def test_audio_source():
    print("=" * 50)
    print("音频源选择测试")
    print("=" * 50)
    
    try:
        from PyQt5.QtWidgets import QApplication
        from gui.gui import ARApp
        
        app = QApplication(sys.argv)
        window = ARApp()
        
        # 测试麦克风选择
        print("\n测试麦克风选择:")
        if hasattr(window, 'audio_source_combo'):
            combo = window.audio_source_combo
            print(f"  可用音频源: {combo.count()}")
            print("  ✓ 音频源选择功能存在")
        
        # 测试系统音频
        print("\n测试系统音频:")
        if hasattr(window, 'system_audio_checkbox'):
            print("  ✓ 系统音频选项存在")
        
        print("\n✓ 音频源选择测试完成")
        return True
        
    except Exception as e:
        print(f"✗ 测试错误: {e}")
        return False

if __name__ == "__main__":
    success = test_audio_source()
    sys.exit(0 if success else 1)
EOF

python3 /tmp/test_audio_source.py
```

### 步骤2: 测试音效应用

```bash
cat > /tmp/test_audio_effects.py << 'EOF'
#!/usr/bin/env python3
import sys
sys.path.insert(0, '/home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/user')

def test_audio_effects():
    print("=" * 50)
    print("音效应用测试")
    print("=" * 50)
    
    try:
        from PyQt5.QtWidgets import QApplication
        from gui.gui import ARApp
        
        app = QApplication(sys.argv)
        window = ARApp()
        
        # 测试音高调整
        print("\n测试音高调整:")
        if hasattr(window, 'pitch_slider'):
            window.pitch_slider.setValue(150)  # 1.5x
            print("  ✓ 音高调整功能存在")
        
        # 测试混响
        print("\n测试混响效果:")
        if hasattr(window, 'reverb_slider'):
            window.reverb_slider.setValue(60)
            print("  ✓ 混响效果功能存在")
        
        # 测试变速
        print("\n测试变速处理:")
        if hasattr(window, 'speed_slider'):
            window.speed_slider.setValue(120)
            print("  ✓ 变速处理功能存在")
        
        print("\n✓ 音效应用测试完成")
        return True
        
    except Exception as e:
        print(f"✗ 测试错误: {e}")
        return False

if __name__ == "__main__":
    success = test_audio_effects()
    sys.exit(0 if success else 1)
EOF

python3 /tmp/test_audio_effects.py
```

### 步骤3: 测试音视频同步

```bash
cat > /tmp/test_av_sync.py << 'EOF'
#!/usr/bin/env python3
import sys
import time
sys.path.insert(0, '/home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/user')

def test_av_sync():
    print("=" * 50)
    print("音视频同步测试")
    print("=" * 50)
    
    try:
        from PyQt5.QtWidgets import QApplication
        from gui.gui import ARApp
        
        app = QApplication(sys.argv)
        window = ARApp()
        
        # 测试同步设置
        print("\n测试同步设置:")
        if hasattr(window, 'sync_offset'):
            print("  ✓ 同步偏移设置存在")
        
        # 测试延迟测量
        print("\n测试延迟测量:")
        if hasattr(window, 'measure_latency'):
            print("  ✓ 延迟测量功能存在")
        
        print("\n✓ 音视频同步测试完成")
        return True
        
    except Exception as e:
        print(f"✗ 测试错误: {e}")
        return False

if __name__ == "__main__":
    success = test_av_sync()
    sys.exit(0 if success else 1)
EOF

python3 /tmp/test_av_sync.py
```

---

## 四、验证步骤

### 验证清单

- [ ] 音频源切换正常
- [ ] 音效实时生效
- [ ] 处理延迟<100ms
- [ ] 音视频同步误差<40ms

---

## 五、预期结果

| 指标 | 目标值 | 验证方法 |
|------|--------|----------|
| 音频源切换 | 正常 | 功能测试 |
| 音效生效 | 实时 | 响应测试 |
| 处理延迟 | <100ms | 性能测试 |
| 音视频同步 | <40ms | 同步测试 |

---

## 六、关联文档

- [任务跟踪-阶段6-核心业务功能验证.md](./任务跟踪-阶段6-核心业务功能验证.md)
- [任务跟踪-阶段6-核心业务功能验证-部署任务6.6-User GUI视频合成功能验证.md](./任务跟踪-阶段6-核心业务功能验证-部署任务6.6-User GUI视频合成功能验证.md)
- [任务跟踪-阶段6-核心业务功能验证-部署任务6.8-GUI后端接口联调验证.md](./任务跟踪-阶段6-核心业务功能验证-部署任务6.8-GUI后端接口联调验证.md)

---

**创建时间:** 2026-02-11
