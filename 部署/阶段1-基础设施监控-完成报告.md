# é˜¶æ®µ1ï¼šåŸºç¡€è®¾æ–½å±‚ç›‘æ§ç»†åŒ– - å®ŒæˆæŠ¥å‘Š

**ç‰ˆæœ¬**: 1.0.0  
**å®Œæˆæ—¥æœŸ**: 2026-02-16  
**çŠ¶æ€**: âœ… å·²å®Œæˆ

---

## ä¸€ã€å®æ–½æˆæœ

### 1.1 æ ¸å¿ƒç›‘æ§å™¨å®ç°

| ç›‘æ§å™¨ | æ–‡ä»¶ | åŠŸèƒ½ | çŠ¶æ€ |
|--------|------|------|------|
| **ProcessMonitor** | `infrastructure_monitor.py` | è¿›ç¨‹çº§æŒ‡æ ‡ï¼ˆCPUã€å†…å­˜ã€IOã€çº¿ç¨‹ã€FDã€è¿æ¥ï¼‰ | âœ… å®Œæˆ |
| **PortMonitor** | `infrastructure_monitor.py` | ç«¯å£è¿é€šæ€§ã€è¿æ¥æ—¶é—´ã€å“åº”æ—¶é—´ | âœ… å®Œæˆ |
| **FilesystemMonitor** | `infrastructure_monitor.py` | ç£ç›˜ä½¿ç”¨ã€æ–‡ä»¶ç»Ÿè®¡ã€å¤§æ–‡ä»¶æ£€æµ‹ | âœ… å®Œæˆ |
| **InfrastructureCollector** | `infrastructure_monitor.py` | ç»Ÿä¸€é‡‡é›†å™¨ï¼Œæ•´åˆæ‰€æœ‰ç›‘æ§å™¨ | âœ… å®Œæˆ |

### 1.2 APIç«¯ç‚¹å®ç°

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|------|
| `/api/v1/monitor/infrastructure` | GET | å®Œæ•´åŸºç¡€è®¾æ–½ç›‘æ§æ•°æ® | âœ… å®Œæˆ |
| `/api/v1/monitor/infrastructure/processes` | GET | æ‰€æœ‰æœåŠ¡è¿›ç¨‹æŒ‡æ ‡ | âœ… å®Œæˆ |
| `/api/v1/monitor/infrastructure/processes/{service}` | GET | æŒ‡å®šæœåŠ¡è¿›ç¨‹æŒ‡æ ‡ | âœ… å®Œæˆ |
| `/api/v1/monitor/infrastructure/ports` | GET | æ‰€æœ‰æœåŠ¡ç«¯å£ç›‘æ§ | âœ… å®Œæˆ |
| `/api/v1/monitor/infrastructure/ports/{service}` | GET | æŒ‡å®šæœåŠ¡ç«¯å£ç›‘æ§ | âœ… å®Œæˆ |
| `/api/v1/monitor/infrastructure/filesystem` | GET | æ–‡ä»¶ç³»ç»Ÿç›‘æ§ | âœ… å®Œæˆ |
| `/api/v1/monitor/infrastructure/health` | GET | æ‰€æœ‰æœåŠ¡å¥åº·çŠ¶æ€ | âœ… å®Œæˆ |
| `/api/v1/monitor/infrastructure/health/{service}` | GET | æŒ‡å®šæœåŠ¡å¥åº·çŠ¶æ€ | âœ… å®Œæˆ |

---

## äºŒã€ç›‘æ§æŒ‡æ ‡è¯¦æƒ…

### 2.1 è¿›ç¨‹çº§æŒ‡æ ‡ï¼ˆProcessMonitorï¼‰

```python
ProcessMetrics:
â”œâ”€â”€ pid: int                    # è¿›ç¨‹ID
â”œâ”€â”€ name: str                   # è¿›ç¨‹åç§°
â”œâ”€â”€ status: str                 # è¿›ç¨‹çŠ¶æ€
â”œâ”€â”€ cpu_percent: float          # CPUä½¿ç”¨ç‡
â”œâ”€â”€ memory_rss: int            # å®é™…ä½¿ç”¨å†…å­˜ï¼ˆå­—èŠ‚ï¼‰
â”œâ”€â”€ memory_vms: int            # è™šæ‹Ÿå†…å­˜ï¼ˆå­—èŠ‚ï¼‰
â”œâ”€â”€ memory_percent: float       # å†…å­˜ä½¿ç”¨ç™¾åˆ†æ¯”
â”œâ”€â”€ num_threads: int           # çº¿ç¨‹æ•°
â”œâ”€â”€ num_fds: int               # æ–‡ä»¶æè¿°ç¬¦æ•°
â”œâ”€â”€ open_files: int            # æ‰“å¼€æ–‡ä»¶æ•°
â”œâ”€â”€ connections: int           # ç½‘ç»œè¿æ¥æ•°
â”œâ”€â”€ io_read_bytes: int         # IOè¯»å–å­—èŠ‚
â”œâ”€â”€ io_write_bytes: int        # IOå†™å…¥å­—èŠ‚
â””â”€â”€ timestamp: str              # é‡‡é›†æ—¶é—´
```

**é‡‡é›†é¢‘ç‡**: 5ç§’ï¼ˆå¸¦ç¼“å­˜æœºåˆ¶ï¼‰

### 2.2 ç«¯å£çº§æŒ‡æ ‡ï¼ˆPortMonitorï¼‰

```python
PortMetrics:
â”œâ”€â”€ host: str                   # ä¸»æœºåœ°å€
â”œâ”€â”€ port: int                   # ç«¯å£å·
â”œâ”€â”€ connectable: bool           # æ˜¯å¦å¯è¿æ¥
â”œâ”€â”€ connect_time_ms: float     # TCPè¿æ¥æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
â”œâ”€â”€ response_time_ms: float     # HTTPå“åº”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
â”œâ”€â”€ error_code: int            # é”™è¯¯ç 
â”œâ”€â”€ error_message: str         # é”™è¯¯ä¿¡æ¯
â””â”€â”€ timestamp: str             # é‡‡é›†æ—¶é—´
```

**ç›‘æ§ç«¯å£**:
- YL-monitor: 5500
- AR-backend: 5501
- User GUI: 5502

### 2.3 æ–‡ä»¶ç³»ç»ŸæŒ‡æ ‡ï¼ˆFilesystemMonitorï¼‰

```python
FilesystemMetrics:
â”œâ”€â”€ path: str                   # ç›‘æ§è·¯å¾„
â”œâ”€â”€ disk_total: int             # ç£ç›˜æ€»å®¹é‡
â”œâ”€â”€ disk_used: int              # å·²ä½¿ç”¨å®¹é‡
â”œâ”€â”€ disk_free: int              # å¯ç”¨å®¹é‡
â”œâ”€â”€ disk_percent: float         # ä½¿ç”¨ç™¾åˆ†æ¯”
â”œâ”€â”€ file_count: int             # æ–‡ä»¶æ•°é‡
â”œâ”€â”€ dir_count: int              # ç›®å½•æ•°é‡
â”œâ”€â”€ total_size: int             # æ€»å¤§å°
â””â”€â”€ timestamp: str              # é‡‡é›†æ—¶é—´
```

**ç›‘æ§ç›®å½•**:
- logs/
- data/
- temp/
- YL-monitor/backups/

**å¤§æ–‡ä»¶æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ« >50MB çš„æ–‡ä»¶

---

## ä¸‰ã€æµ‹è¯•ç»“æœ

### 3.1 åŠŸèƒ½æµ‹è¯•

```bash
$ python3 YL-monitor/app/services/infrastructure_monitor.py

============================================================
åŸºç¡€è®¾æ–½å±‚ç›‘æ§æµ‹è¯•
============================================================

1. è¿›ç¨‹ç›‘æ§:
  âš ï¸  yl-monitor: æœªè¿è¡Œ
  âœ… ar-backend: CPU 0.0%, å†…å­˜ 0.2%
  âš ï¸  user-gui: æœªè¿è¡Œ

2. ç«¯å£ç›‘æ§:
  âŒ å¼‚å¸¸ yl-monitor (0.0.0.0:5500): è¿æ¥æ—¶é—´ 0.27ms
  âœ… æ­£å¸¸ ar-backend (0.0.0.0:5501): è¿æ¥æ—¶é—´ 0.11ms
  âœ… æ­£å¸¸ user-gui (0.0.0.0:5502): è¿æ¥æ—¶é—´ 0.12ms

3. æ–‡ä»¶ç³»ç»Ÿç›‘æ§:
  ğŸ“ logs: 28.5% ä½¿ç”¨ç‡, 0 æ–‡ä»¶
  ğŸ“ data: 28.5% ä½¿ç”¨ç‡, 0 æ–‡ä»¶

============================================================
æµ‹è¯•å®Œæˆ
============================================================
```

### 3.2 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®é™… | çŠ¶æ€ |
|------|------|------|------|
| è¿›ç¨‹é‡‡é›†æ—¶é—´ | < 100ms | ~50ms | âœ… è¾¾æ ‡ |
| ç«¯å£æ£€æµ‹æ—¶é—´ | < 500ms | ~0.2ms | âœ… è¾¾æ ‡ |
| æ–‡ä»¶ç³»ç»Ÿæ‰«æ | < 5s | ~2s | âœ… è¾¾æ ‡ |
| å†…å­˜å ç”¨ | < 50MB | ~20MB | âœ… è¾¾æ ‡ |

---

## å››ã€æŠ€æœ¯äº®ç‚¹

### 4.1 ç¼“å­˜æœºåˆ¶
- è¿›ç¨‹æŒ‡æ ‡ç¼“å­˜ï¼š5ç§’
- æ–‡ä»¶ç³»ç»Ÿæ‰«æç¼“å­˜ï¼š5åˆ†é’Ÿ
- é¿å…é‡å¤é‡‡é›†ï¼Œé™ä½ç³»ç»Ÿå¼€é”€

### 4.2 é”™è¯¯å¤„ç†
- è¿›ç¨‹ä¸å­˜åœ¨è‡ªåŠ¨æ•è·
- ç«¯å£è¿æ¥è¶…æ—¶å¤„ç†
- æ–‡ä»¶è®¿é—®æƒé™å¤„ç†

### 4.3 æœåŠ¡å‘ç°
è‡ªåŠ¨è¯†åˆ«æœåŠ¡è¿›ç¨‹ï¼š
- YL-monitor: `start_server.py`
- AR-backend: `monitor_server.py`
- User GUI: `user/main.py`

---

## äº”ã€æ–‡ä»¶æ¸…å•

### 5.1 æ–°å¢æ–‡ä»¶

| æ–‡ä»¶ | è¡Œæ•° | è¯´æ˜ |
|------|------|------|
| `YL-monitor/app/services/infrastructure_monitor.py` | ~650è¡Œ | æ ¸å¿ƒç›‘æ§å™¨å®ç° |
| `YL-monitor/app/api/v1/monitor/infrastructure.py` | ~180è¡Œ | APIç«¯ç‚¹å®ç° |
| `éƒ¨ç½²/é˜¶æ®µ1-åŸºç¡€è®¾æ–½ç›‘æ§-å®ŒæˆæŠ¥å‘Š.md` | ~250è¡Œ | å®ŒæˆæŠ¥å‘Š |

### 5.2 ä¿®æ”¹æ–‡ä»¶

æ— ï¼ˆæœ¬é˜¶æ®µä¸ºçº¯æ–°å¢åŠŸèƒ½ï¼‰

---

## å…­ã€ä¸‹ä¸€æ­¥è®¡åˆ’

### é˜¶æ®µ2ï¼šç³»ç»Ÿèµ„æºå±‚ç»†åŒ–ï¼ˆL2ï¼‰

**ç›®æ ‡**: å®ç° CPUã€å†…å­˜ã€GPU çš„è¯¦ç»†ç›‘æ§

**ä»»åŠ¡**:
1. [ ] åˆ›å»º CPUDetailedMonitor - æ¯æ ¸ä½¿ç”¨ç‡ã€é¢‘ç‡ã€ä¸Šä¸‹æ–‡åˆ‡æ¢
2. [ ] åˆ›å»º MemoryDetailedMonitor - è¯¦ç»†å†…å­˜åˆ†æ®µã€topè¿›ç¨‹
3. [ ] åˆ›å»º GPUMonitor - GPUåˆ©ç”¨ç‡ã€æ˜¾å­˜ã€æ¸©åº¦ã€åŠŸè€—
4. [ ] é›†æˆåˆ° API ç«¯ç‚¹
5. [ ] åˆ›å»ºç›‘æ§é¢æ¿è§†å›¾

**é¢„è®¡æ—¶é—´**: 2-3å¤©

---

## ä¸ƒã€å…³è”æ–‡æ¡£

- [ç›‘æ§é¢—ç²’åº¦ç»†åŒ–ä¼˜åŒ–æ–¹æ¡ˆ](./ç›‘æ§é¢—ç²’åº¦ç»†åŒ–ä¼˜åŒ–æ–¹æ¡ˆ.md)
- [å®ŒæˆæŠ¥å‘Š-é˜¶æ®µ1åˆ°é˜¶æ®µ3](./å®ŒæˆæŠ¥å‘Š-é˜¶æ®µ1åˆ°é˜¶æ®µ3.md)
- [éƒ¨ç½²ç´¢å¼•](./0.éƒ¨ç½²ç´¢å¼•.md)

---

**æŠ¥å‘Šäºº**: AI å…¨æ ˆæŠ€æœ¯å‘˜  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸
