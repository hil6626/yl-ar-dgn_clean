# 部署任务10.2: 版本标记和发布

**任务ID:** 10.2  
**所属阶段:** 阶段10 - 打包和交付  
**任务名称:** 版本标记和发布  
**优先级:** P0（最高优先级）  
**关键性:** 阻塞性  
**预计工时:** 3小时  
**负责人:** 版本管理员  
**前置依赖:** 任务10.1完成  
**状态:** 待开始

---

## 一、任务目标

完成版本标记和发布，包括版本号确定、Git标签创建、发布说明编写和版本发布。

---

## 二、工作内容

1. 版本号确定
2. Git标签创建
3. 发布说明编写
4. 版本发布
5. 版本归档

---

## 三、实施步骤

### 步骤1: 创建版本标记脚本

```bash
cat > /home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/scripts/create_release.sh << 'EOF'
#!/bin/bash
set -e

VERSION=$1
if [ -z "$VERSION" ]; then
    echo "用法: $0 <版本号>"
    echo "示例: $0 v2.0.0"
    exit 1
fi

echo "========================================"
echo "创建版本发布"
echo "版本: ${VERSION}"
echo "========================================"

# 1. 检查工作区
echo "1. 检查Git工作区..."
if [ -n "$(git status --porcelain)" ]; then
    echo "错误: 工作区有未提交的更改"
    git status
    exit 1
fi
echo "   ✓ 工作区干净"

# 2. 更新版本号
echo "2. 更新版本号..."
echo "${VERSION}" > VERSION
echo "   ✓ 版本号已更新"

# 3. 提交版本更新
echo "3. 提交版本更新..."
git add VERSION
git commit -m "Release ${VERSION}"
echo "   ✓ 版本提交完成"

# 4. 创建标签
echo "4. 创建Git标签..."
git tag -a "${VERSION}" -m "Release ${VERSION}"
echo "   ✓ 标签创建完成"

# 5. 推送代码和标签
echo "5. 推送到远程仓库..."
git push origin main
git push origin "${VERSION}"
echo "   ✓ 推送完成"

echo "========================================"
echo "版本发布创建完成: ${VERSION}"
echo "========================================"
EOF

chmod +x /home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/scripts/create_release.sh
echo "✓ 版本标记脚本已创建"
```

### 步骤2: 创建发布说明模板

```bash
cat > /home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/docs/RELEASE_TEMPLATE.md << 'EOF'
# AR Live Studio v{VERSION} 发布说明

## 版本信息
- **版本号**: {VERSION}
- **发布日期**: {DATE}
- **Git标签**: {TAG}

## 主要更新

### 新功能
- 功能1描述
- 功能2描述

### 改进
- 改进1描述
- 改进2描述

### 修复
- 修复1描述
- 修复2描述

## 系统要求
- Python 3.8+
- Docker 20.10+
- Ubuntu 20.04+ / Windows 10+ / macOS 11+

## 安装方式
```bash
# 下载发布包
wget https://github.com/your-org/yl-ar-dgn/releases/download/{VERSION}/ar-studio-{VERSION}.tar.gz

# 解压
tar -xzf ar-studio-{VERSION}.tar.gz
cd ar-studio-{VERSION}

# 安装
./install.sh
```

## 升级指南
```bash
# 备份当前版本
./scripts/backup.sh

# 下载新版本
# ... 按照安装方式安装

# 恢复配置
cp -r backup/config/* config/
```

## 已知问题
- 问题1: 描述和解决方案
- 问题2: 描述和解决方案

## 文档
- [安装指南](docs/user/INSTALL.md)
- [使用手册](docs/user/MANUAL.md)
- [API文档](docs/developer/API.md)

## 支持
- 问题反馈: https://github.com/your-org/yl-ar-dgn/issues
- 文档: https://docs.ar-studio.com
EOF

echo "✓ 发布说明模板已创建"
```

### 步骤3: 验证版本标记

```bash
cat > /tmp/verify_version_release.sh << 'EOF'
#!/bin/bash
echo "========================================"
echo "版本标记和发布验证"
echo "========================================"

errors=0

# 检查版本标记脚本
echo -n "检查版本标记脚本... "
if [ -f "/home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/scripts/create_release.sh" ]; then
    echo "✓ 通过"
else
    echo "✗ 失败"
    errors=$((errors + 1))
fi

# 检查发布说明模板
echo -n "检查发布说明模板... "
if [ -f "/home/vboxuser/桌面/项目部署/项目1/yl-ar-dgn_clean/docs/RELEASE_TEMPLATE.md" ]; then
    echo "✓ 通过"
else
    echo "✗ 失败"
    errors=$((errors + 1))
fi

echo "========================================"
if [ $errors -eq 0 ]; then
    echo "✓ 版本标记和发布验证通过"
    exit 0
else
    echo "✗ 版本标记和发布验证失败 ($errors 个错误)"
    exit 1
fi
EOF

chmod +x /tmp/verify_version_release.sh
/tmp/verify_version_release.sh
```

---

## 四、验证步骤

### 验证清单

- [ ] 版本号确定
- [ ] Git标签创建
- [ ] 发布说明编写
- [ ] 版本发布完成

---

## 五、预期结果

| 指标 | 目标值 | 验证方法 |
|------|--------|----------|
| 版本号 | 确定 | 版本文件 |
| Git标签 | 创建 | 标签检查 |
| 发布说明 | 编写 | 文档检查 |
| 版本发布 | 完成 | 发布验证 |

---

## 六、关联文档

- [任务跟踪-阶段10-打包和交付.md](./任务跟踪-阶段10-打包和交付.md)
- [任务跟踪-阶段10-打包和交付-部署任务10.1-代码审查和清理.md](./任务跟踪-阶段10-打包和交付-部署任务10.1-代码审查和清理.md)
- [任务跟踪-阶段10-打包和交付-部署任务10.3-安装包制作.md](./任务跟踪-阶段10-打包和交付-部署任务10.3-安装包制作.md)

---

**创建时间:** 2026-02-11
