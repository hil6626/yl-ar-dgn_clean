# 规则中心（Rules）

项目的运行规则与系统逻辑中枢。以**分层规则框架**为单一真相来源，指导整个项目的架构、开发、部署与运维。

---

## 📊 部署进度

| 阶段 | 名称 | 状态 | 完成日期 | 进度 |
|------|------|------|----------|------|
| 阶段1 | 监控整合 | ✅ 已完成 | 2026-02-16 | 100% |
| 阶段2 | User GUI优化 | ✅ 已完成 | 2026-02-16 | 100% |
| 阶段3 | 规则架构部署 | ✅ 已完成 | 2026-02-16 | 100% |
| 阶段4 | 脚本整合 | ✅ 已完成 | 2026-02-16 | 100% |
| 阶段5 | 联调测试 | ✅ 已完成 | 2026-02-16 | 100% |

**总体进度: 100% (30/30任务)**

### 当前状态
- ✅ YL-monitor (端口5500): 统一监控平台运行中，五层监控架构已部署
- ✅ AR-backend (端口5501): 监控服务运行中，健康检查正常
- ✅ User GUI (端口5502): 状态上报服务运行中，API通信正常
- ✅ 规则L1-L5: 已全部更新并完成验证(v1.2.0)，规则引擎已增强并通过33项集成测试
- ✅ 脚本整合: 10个脚本已迁移，统一入口yl-ar-dgn.sh支持15+命令
- ✅ 联调测试: 23项测试全部通过，100%成功率

---

## 📋 框架概述

### 五层规则架构

| 层级 | 文件 | 描述 | 用途 |
|------|------|------|------|
| **L1** | `L1-meta-goal.json` | 元目标层 | 定义项目最高优先级目标、演进方向与成熟度路线图 |
| **L2** | `L2-understanding.json` | 理解层 | 系统理解深度、技术决策前提与领域认知 |
| **L3** | `L3-constraints.json` | 约束层 | 项目边界、技术限制、依赖关系与必去风险 |
| **L4** | `L4-decisions.json` | 决策层 | 架构方案、接口设计、工作流规范与选型依据 |
| **L5** | `L5-execution.json` | 执行层 | 具体操作步骤、脚本命令、部署流程与验证标准 |

---

## 🎯 核心规范

### 前端交互规范
- 📄 [前端联动与交互规范](../docs/project/rules-docs/frontend-interaction-spec.md)
  - 前端组件生命周期
  - API 调用约定
  - 事件流管理
  - 错误处理标准

---

## 🚀 快速导航

### 系统初始化
1. 查看 **L1 元目标** 了解项目方向
2. 查看 **L3 约束** 理解系统限制
3. 查看 **L5 执行** 获取启动命令

### 规则引擎校验（建议）
```bash
# 校验 rules.config.js 与 L1~L5 是否可用
python3 scripts/validation/validate_rules_engine.py --json

# 校验入口是否存在（基于 L2-understanding.json）
python3 scripts/validation/validate_entrypoints.py --json
```

### 开发工作流
1. 查看 **L2 理解** 确保认知一致
2. 查看 **L4 决策** 理解架构约定
3. 查看 **L5 执行** 操作实现步骤

### 问题排查
- 架构问题 → 查看 **L4 决策**
- 流程问题 → 查看 **L5 执行**
- 边界问题 → 查看 **L3 约束**

---

## 📚 文件说明

### index.js
规则系统的入口与加载器，管理所有规则文件的加载与访问。

### rules.config.js
规则引擎的基本配置，包含版本、依赖路径与全局设置。

---

## 🔄 更新流程

修改规则时必须遵循层级关系：
1. **底层变更**（L5 执行）→ 仅更新执行步骤
2. **决策变更**（L4 以上）→ 级联更新相关下层规则
3. **目标变更**（L1 以上）→ 重新梳理整个规则体系

### 阶段3任务清单 (规则架构部署)
- [x] 任务3.1: 更新L1元目标层 (标记阶段1&2完成)
- [x] 任务3.2: 更新L2理解层 (更新组件状态)
- [x] 任务3.3: 完善L3约束层 (添加部署约束和验证状态)
- [x] 任务3.4: 完善L4决策层 (更新成熟度策略和决策规则)
- [x] 任务3.5: 更新L5执行层 (标记阶段1&2完成)
- [x] 任务3.6: 完善规则引擎 (index.js增强，添加动态重载、规则验证、冲突检测功能)
- [x] 任务3.7: 规则集成测试 (创建测试脚本并通过33项测试验证)

### 阶段4任务清单 (脚本整合)
- [x] 任务4.1: 脚本审查与分类 (创建SCRIPT_INVENTORY_V2.md)
- [x] 任务4.2: 消除重复脚本 (迁移10个脚本)
- [x] 任务4.3: 统一入口完善 (增强yl-ar-dgn.sh，添加15+命令)

### 阶段5任务清单 (联调测试)
- [x] 任务5.1: 监控整合测试 (3个服务全部运行正常)
- [x] 任务5.2: User GUI功能测试 (API端点全部返回200)
- [x] 任务5.3: 故障模拟测试 (故障检测和恢复机制有效)
- [x] 任务5.4: 脚本整合测试 (15+个命令全部可用)
- [x] 任务5.5: 规则架构测试 (33项集成测试全部通过)
- [x] 任务5.6: 端到端测试 (23项测试100%通过率)

---

## 📖 相关文档

- [项目总览] → [../README.md](../README.md)
- [任务追踪] → [../TODO.md](../TODO.md)
- [阶段1报告] → [../部署/阶段1-监控整合-完成报告.md](../部署/阶段1-监控整合-完成报告.md)
- [阶段2报告] → [../部署/阶段2-UserGUI优化-完成报告.md](../部署/阶段2-UserGUI优化-完成报告.md)
- [阶段3报告] → [../部署/阶段3-规则架构部署-完成报告.md](../部署/阶段3-规则架构部署-完成报告.md)
- [阶段4报告] → [../部署/阶段4-脚本整合-完成报告.md](../部署/阶段4-脚本整合-完成报告.md)
- [阶段5报告] → [../部署/阶段5-联调测试-完成报告.md](../部署/阶段5-联调测试-完成报告.md)
- [后端说明] → [../AR-backend/README.md](../AR-backend/README.md)
- [监控前端] → [../YL-monitor/README.md](../YL-monitor/README.md)
- [用户界面] → [../user/README.md](../user/README.md)
- [脚本说明] → [../scripts/README.md](../scripts/README.md)
