{
  "name": "L2 全局理解层",
  "description": "yl-ar-dgn 的组件边界、运行形态与当前部署现实（含已知缺口）",
  "version": "1.2.0",
  "lastUpdated": "2026-02-16",
  "architecture": {
    "modules": [
      {
        "name": "AR-backend",
        "type": "python",
        "purpose": "后端核心能力：人脸/视频/音频处理、服务编排、脚本执行与告警。监控服务已部署运行。",
        "entrypoints": ["AR-backend/monitor_server.py", "AR-backend/app/launcher.py"],
        "status": "running",
        "port": 5501,
        "notes": ["监控服务运行中 (端口5501)，提供/health、/status、/metrics端点"]
      },
      {
        "name": "YL-monitor",
        "type": "fastapi-web",
        "purpose": "统一监控平台，提供浏览器监控面板和统一监控API。",
        "entrypoints": ["YL-monitor/app/main.py"],
        "status": "running",
        "port": 5500,
        "notes": ["统一监控面板已部署，支持UI层/API层/DAG层监控"]
      },
      {
        "name": "scripts",
        "type": "python",
        "purpose": "自动化与运维脚本（监控、健康检查、资源监控、安全扫描等）。",
        "entrypoints": ["scripts/yl-ar-dgn.sh", "scripts/scripts_manager.py"],
        "notes": ["统一入口脚本yl-ar-dgn.sh已创建"]
      },
      {
        "name": "user",
        "type": "python-gui",
        "purpose": "本地 PyQt5 GUI 用户界面（桌面端交互入口）。",
        "entrypoints": ["user/main.py"],
        "status": "optimized",
        "port": 5502,
        "notes": [
          "main.py已优化，支持路径自动发现",
          "path_manager.py已创建，修复导入路径",
          "ar_backend_client.py已创建，支持服务发现",
          "settings.py已创建，支持配置管理",
          "状态上报服务运行中 (端口5502)"
        ]
      },
      {
        "name": "api-map",
        "type": "data",
        "purpose": "API/节点映射与前后端契约。",
        "entrypoints": ["api-map/routes", "api-map/registry.json"]
      }
    ],
    "runtimeTopology": {
      "currentReality": [
        "YL-monitor (端口5500): 统一监控平台运行中，提供统一监控面板",
        "AR-backend (端口5501): 监控服务运行中，提供健康检查和状态查询",
        "User GUI (端口5502): GUI优化完成，状态上报服务运行中",
        "统一监控: YL-monitor通过/api/v1/monitor/*端点监控所有组件"
      ],
      "targetDirection": [
        "单一后端服务入口（HTTP/WebSocket）+ 单一监控入口（Web UI）+ 统一脚本调度入口（scripts_manager）。",
        "api-map/registry.json 作为前后端地址与能力注册中心。",
        "rules/ 作为策略与约束的单一真相来源。"
      ]
    },
    "dataFlow": [
      "YL-monitor（浏览器）→ 统一监控API → AR-backend/User GUI（状态收集）",
      "User GUI（PyQt5）→ AR-backend（视频/音频处理）",
      "scripts（健康检查）→ logs/（落盘）→ YL-monitor（展示）"
    ]
  },
  "knownGaps": [
    "api-map/registry.json 为空，无法承载环境地址/端点注册。",
    "部分监控路由/脚本映射引用了不存在的脚本文件（需对齐 scripts/monitor 实际文件）。",
    "rules/L3-L5需要完善以支持部署阶段3-5。"
  ],
  "completedImprovements": [
    "阶段1-监控整合 (2026-02-16): AR-backend监控服务(5501)、User-GUI状态上报(5502)、YL-monitor统一监控面板(5500)、告警规则配置全部完成",
    "阶段2-GUI优化 (2026-02-16): main.py入口、路径修复模块(path_manager.py)、服务客户端(ar_backend_client.py)、配置管理(settings.py)、功能验证全部完成"
  ],
  "deploymentStatus": {
    "phase1": {
      "name": "监控整合",
      "status": "completed",
      "completionDate": "2026-02-16",
      "progress": "100%"
    },
    "phase2": {
      "name": "User GUI优化",
      "status": "completed",
      "completionDate": "2026-02-16",
      "progress": "100%"
    },
    "phase3": {
      "name": "规则架构部署",
      "status": "in_progress",
      "progress": "0%"
    },
    "phase4": {
      "name": "脚本整合",
      "status": "pending",
      "progress": "0%"
    },
    "phase5": {
      "name": "联调测试",
      "status": "pending",
      "progress": "0%"
    }
  },
  "rules": [
    {
      "id": "maturity-default",
      "condition": { "field": "deployment_maturity_level", "operator": "equals", "value": null },
      "action": { "target": "deployment_maturity_level", "value": 2 },
      "description": "当前成熟度为 Level 2（监控整合完成，GUI优化完成）"
    }
  ]
}
