{
  "name": "L5 执行层",
  "description": "按部署成熟度分阶段的可执行清单（以可验证 Gate 为验收口径）",
  "version": "1.2.0",
  "lastUpdated": "2026-02-16",
  "executionPlans": {
    "local-manual": {
      "gates": ["entrypoints_exist", "basic_health_check"],
      "phases": [
        {
          "name": "bootstrap",
          "status": "completed",
          "completedDate": "2026-02-16",
          "steps": [
            "确认入口：user/main.py 可启动 GUI；YL-monitor (5500) 运行中；AR-backend (5501) 运行中",
            "确认 logs/ 目录存在并可写",
            "运行基础脚本：统一监控面板验证通过"
          ]
        }
      ]
    },
    "local-automated": {
      "gates": ["scripts_mapping_consistent", "log_dirs_ready", "monitoring_integration", "gui_optimization"],
      "phases": [
        {
          "name": "phase1-monitoring-integration",
          "status": "completed",
          "completedDate": "2026-02-16",
          "steps": [
            "AR-backend监控服务 (端口5501)：/health、/status、/metrics端点运行中",
            "User-GUI状态上报 (端口5502)：状态上报服务运行中",
            "YL-monitor统一监控 (端口5500)：统一监控面板部署完成",
            "告警规则配置：统一监控API支持UI层/API层/DAG层监控"
          ]
        },
        {
          "name": "phase2-gui-optimization",
          "status": "completed",
          "completedDate": "2026-02-16",
          "steps": [
            "user/main.py入口：支持路径自动发现和监控集成",
            "user/core/path_manager.py：动态Python路径设置",
            "user/services/ar_backend_client.py：HTTP服务客户端",
            "user/config/settings.py：配置管理器",
            "功能验证：所有README文档已同步更新"
          ]
        },
        {
          "name": "contract-alignment",
          "status": "in_progress",
          "steps": [
            "对齐脚本契约：路由/服务引用的脚本文件必须存在且可执行",
            "统一脚本输出：支持 --json（或明确的输出约定）",
            "补齐 api-map/registry.json 的 local/dev 地址与端点"
          ]
        }
      ]
    },
    "singlehost-managed": {
      "gates": ["process_supervision", "config_baseline", "rollback_plan"],
      "phases": [
        {
          "name": "service-shaping",
          "steps": [
            "确定后端服务入口（统一 HTTP/WebSocket 服务，不与 GUI 入口混用）",
            "引入进程守护（systemd 或 supervisord）与自动重启",
            "建立配置基线：端口、路径、日志级别、依赖检查",
            "准备回滚：版本备份、配置回滚、健康探测"
          ]
        }
      ]
    },
    "containerized": {
      "gates": ["container_build", "health_probe", "config_injection"],
      "phases": [
        {
          "name": "container-baseline",
          "steps": [
            "提供可重复构建镜像（后端/监控可分别镜像化）",
            "明确健康探针（/health 或脚本探针）",
            "通过环境变量/挂载注入配置与 secrets"
          ]
        }
      ]
    },
    "production-ready": {
      "gates": ["metrics_alerts", "audit_trail", "slo_sla"],
      "phases": [
        {
          "name": "observability",
          "steps": [
            "指标：关键资源、任务耗时、失败率、告警次数",
            "日志：统一字段与关联 ID；保留周期与脱敏策略",
            "审计：高风险操作留痕与回滚记录",
            "降级：当资源超阈值或关键依赖不可用时有明确 fallback"
          ]
        }
      ]
    }
  },
  "automation": {
    "scripts": [
      "scripts/yl-ar-dgn.sh",
      "scripts/verify_start.sh",
      "scripts/check_dependencies.py",
      "scripts/check_scripts_integrity.py",
      "scripts/validation/validate_rules_engine.py",
      "scripts/validation/validate_entrypoints.py",
      "scripts/monitor/health_check.py",
      "scripts/monitor/resource_monitor.py",
      "scripts/security/security_scan.py"
    ]
  },
  "completedPhases": [
    {
      "id": "phase1",
      "name": "监控整合",
      "status": "completed",
      "completionDate": "2026-02-16",
      "deliverables": [
        "AR-backend监控服务 (5501)",
        "User-GUI状态上报 (5502)",
        "YL-monitor统一监控面板 (5500)",
        "统一监控API架构"
      ]
    },
    {
      "id": "phase2",
      "name": "User GUI优化",
      "status": "completed",
      "completionDate": "2026-02-16",
      "deliverables": [
        "user/main.py优化入口",
        "user/core/path_manager.py路径管理",
        "user/services/ar_backend_client.py服务客户端",
        "user/config/settings.py配置管理",
        "所有README文档同步更新"
      ]
    }
  ],
  "rules": [
    {
      "id": "completed-to-validated",
      "condition": { "field": "phase", "operator": "equals", "value": "completed" },
      "action": { "target": "status", "value": "validated" },
      "description": "阶段标记完成后，自动将状态置为 validated"
    },
    {
      "id": "timeout-warning",
      "condition": { "field": "execution_time", "operator": "greater", "value": 30 },
      "action": { "target": "alert", "value": "timeout_warning" },
      "description": "执行超时发出警告（默认阈值 30 秒）"
    }
  ]
}
