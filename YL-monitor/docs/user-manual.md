# YL-Monitor 用户手册

**版本**: 1.0.0  
**适用对象**: 终端用户、运维人员  
**最后更新**: 2026-02-10

---

## 📚 目录

1. [系统简介](#一系统简介)
2. [快速开始](#二快速开始)
3. [功能模块](#三功能模块)
4. [日常使用](#四日常使用)
5. [故障排查](#五故障排查)
6. [常见问题](#六常见问题)

---

## 一、系统简介

### 1.1 什么是 YL-Monitor？

YL-Monitor 是一个企业级监控告警平台，提供：

- 🔍 **系统监控**: CPU、内存、磁盘、网络实时监控
- 📊 **可视化仪表盘**: 直观的数据展示和趋势分析
- 🚨 **智能告警**: 多渠道告警通知（邮件、Webhook、短信）
- 🔄 **任务调度**: DAG工作流管理和脚本执行
- 🔒 **安全认证**: JWT认证和RBAC权限控制

### 1.2 系统架构

```
┌─────────────────────────────────────────┐
│           用户界面层 (Web UI)            │
├─────────────────────────────────────────┤
│           API 接口层 (REST/WebSocket)    │
├─────────────────────────────────────────┤
│  监控服务 │ 告警服务 │ 任务服务 │ AR服务  │
├─────────────────────────────────────────┤
│           数据存储层 (SQLite/Redis)      │
└─────────────────────────────────────────┘
```

### 1.3 核心特性

| 特性 | 说明 | 优势 |
|------|------|------|
| 实时监控 | 秒级数据采集 | 及时发现问题 |
| 智能告警 | 阈值+趋势双检测 | 减少误报漏报 |
| 高性能 | 缓存+异步+压缩 | 支持大规模部署 |
| 高安全 | JWT+加密+审计 | 企业级安全 |
| 易扩展 | 模块化+插件化 | 快速定制开发 |

---

## 二、快速开始

### 2.1 访问系统

**默认访问地址**:
- Web界面: `http://0.0.0.0:8000`
- API文档: `http://0.0.0.0:8000/api/docs`
- 健康检查: `http://0.0.0.0:8000/health`

### 2.2 首次登录

1. 打开浏览器访问 `http://0.0.0.0:8000`
2. 使用默认账号登录：
   - 用户名: `admin`
   - 密码: `admin123` (首次登录后请立即修改)
3. 进入系统后，建议：
   - 修改默认密码
   - 配置个人通知渠道
   - 查看系统概览

### 2.3 界面导览

```
┌─────────────────────────────────────────────────────┐
│  [Logo]  YL-Monitor    仪表盘  监控  告警  DAG  设置   │
├─────────────────────────────────────────────────────┤
│                                                     │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐ │
│  │  CPU使用率   │  │  内存使用率  │  │  磁盘使用率  │ │
│  │    45%      │  │    60%      │  │    30%      │ │
│  └─────────────┘  └─────────────┘  └─────────────┘ │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │           系统负载趋势图                      │   │
│  │    [████████████████████░░░░░░░░░░░░░░]     │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
│  ┌─────────────────────────────────────────────┐   │
│  │  最近告警                                     │   │
│  │  ⚠️ CPU使用率超过阈值 (2026-02-10 10:30)     │   │
│  │  ✅ 内存使用恢复正常 (2026-02-10 10:15)      │   │
│  └─────────────────────────────────────────────┘   │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 三、功能模块

### 3.1 仪表盘 (Dashboard)

**功能**: 系统整体状态概览

**主要组件**:
- 实时指标卡片 (CPU/内存/磁盘/网络)
- 趋势图表 (支持时间范围选择)
- 告警统计 (今日/本周/本月)
- 任务状态 (运行中/已完成/失败)

**操作指南**:
1. 点击指标卡片查看详情
2. 拖拽图表调整布局
3. 点击时间选择器切换时间范围
4. 点击告警列表跳转到告警详情

### 3.2 监控中心 (Monitoring)

**功能**: 查看和管理监控指标

**子功能**:
- **系统监控**: CPU、内存、磁盘、网络、进程
- **应用监控**: Web应用、数据库、API
- **自定义监控**: 用户自定义脚本监控

**操作指南**:
1. 选择监控类型 (系统/应用/自定义)
2. 选择目标主机或服务
3. 查看实时数据和历史趋势
4. 设置监控阈值

### 3.3 告警管理 (Alerts)

**功能**: 告警规则配置和告警历史

**子功能**:
- **告警规则**: 创建/编辑/删除告警规则
- **告警历史**: 查看所有告警记录
- **告警通知**: 配置通知渠道

**创建告警规则步骤**:
1. 进入"告警管理" → "告警规则"
2. 点击"新建规则"
3. 填写规则信息：
   - 规则名称: `CPU高负载告警`
   - 监控指标: `system.cpu.usage`
   - 告警条件: `> 80%`
   - 持续时间: `5分钟`
   - 通知渠道: `邮件+Webhook`
4. 点击"保存并启用"

### 3.4 DAG工作流 (DAG)

**功能**: 可视化工作流管理和执行

**子功能**:
- **DAG设计器**: 拖拽式工作流设计
- **DAG执行**: 手动/自动触发执行
- **执行历史**: 查看执行记录和日志

**创建DAG步骤**:
1. 进入"DAG管理" → "新建DAG"
2. 拖拽节点到画布：
   - 开始节点 → 任务节点 → 结束节点
3. 连接节点形成流程
4. 配置每个节点的参数
5. 保存并测试执行

**支持的节点类型**:
- 开始/结束节点
- 脚本执行节点
- 条件判断节点
- 并行处理节点
- 延时等待节点

### 3.5 脚本管理 (Scripts)

**功能**: 监控脚本的管理和执行

**子功能**:
- **脚本列表**: 查看所有脚本
- **脚本编辑**: 在线编辑脚本
- **脚本执行**: 手动/定时执行
- **执行日志**: 查看执行输出

**支持的脚本类型**:
- Python脚本
- Shell脚本
- SQL查询

### 3.6 系统设置 (Settings)

**功能**: 系统配置和个人设置

**子功能**:
- **用户管理**: 添加/编辑/删除用户
- **角色权限**: 配置角色和权限
- **通知设置**: 配置通知渠道
- **系统配置**: 全局参数配置

---

## 四、日常使用

### 4.1 查看系统状态

**场景**: 每天早上检查系统状态

**操作步骤**:
1. 登录系统，进入仪表盘
2. 查看关键指标卡片：
   - CPU使用率 < 70% ✅
   - 内存使用率 < 80% ✅
   - 磁盘使用率 < 90% ✅
3. 查看趋势图表，确认无异常波动
4. 查看告警列表，处理未解决告警

### 4.2 处理告警

**场景**: 收到CPU高负载告警

**操作步骤**:
1. 点击告警通知，进入告警详情
2. 查看告警信息：
   - 告警时间: 2026-02-10 10:30
   - 告警内容: CPU使用率 85% > 阈值 80%
   - 影响主机: server-01
3. 进入监控中心，查看详细指标
4. 分析原因：
   - 查看进程列表，找出高CPU进程
   - 查看历史趋势，确认是否持续
5. 采取措施：
   - 如果是异常进程，考虑终止
   - 如果是正常负载，考虑扩容
6. 处理完成后，标记告警为"已解决"

### 4.3 创建监控任务

**场景**: 新增数据库监控

**操作步骤**:
1. 进入"脚本管理" → "新建脚本"
2. 编写监控脚本：
   ```python
   # db_monitor.py
   import psutil
   import sqlite3
   
   def check_db_status():
       conn = sqlite3.connect('monitor.db')
       cursor = conn.cursor()
       
       # 检查连接数
       cursor.execute("SELECT COUNT(*) FROM connections")
       conn_count = cursor.fetchone()[0]
       
       # 检查慢查询
       cursor.execute("""
           SELECT query, time_ms 
           FROM slow_queries 
           WHERE time_ms > 1000
       """)
       slow_queries = cursor.fetchall()
       
       return {
           'connection_count': conn_count,
           'slow_queries': len(slow_queries)
       }
   ```
3. 保存脚本
4. 创建定时任务，每5分钟执行一次
5. 创建告警规则，当连接数>100或慢查询>10时告警

### 4.4 导出报表

**场景**: 生成月度监控报表

**操作步骤**:
1. 进入"仪表盘" → "报表中心"
2. 选择报表类型：
   - 系统资源使用报表
   - 告警统计报表
   - 任务执行报表
3. 选择时间范围：上月
4. 点击"生成报表"
5. 下载PDF/Excel格式报表

---

## 五、故障排查

### 5.1 系统无法访问

**现象**: 浏览器无法打开系统页面

**排查步骤**:
1. 检查服务状态：
   ```bash
   sudo systemctl status yl-monitor
   ```
2. 检查端口监听：
   ```bash
   netstat -tlnp | grep 8000
   ```
3. 查看错误日志：
   ```bash
   tail -f /var/log/yl-monitor/error.log
   ```
4. 检查磁盘空间：
   ```bash
   df -h
   ```

**常见原因**:
- 服务未启动
- 端口被占用
- 磁盘空间不足
- 配置文件错误

### 5.2 告警不触发

**现象**: 指标超过阈值但未收到告警

**排查步骤**:
1. 检查告警规则状态：
   - 确认规则已启用
   - 确认时间窗口设置正确
2. 检查通知渠道：
   - 确认邮件/Webhook配置正确
   - 测试通知渠道
3. 查看告警日志：
   ```bash
   tail -f /var/log/yl-monitor/alert.log
   ```
4. 检查告警历史：
   - 进入"告警管理" → "告警历史"
   - 查看是否有记录

### 5.3 性能问题

**现象**: 页面加载慢，查询超时

**排查步骤**:
1. 检查系统资源：
   - CPU使用率
   - 内存使用率
   - 磁盘I/O
2. 检查数据库：
   - 慢查询日志
   - 连接池状态
3. 检查缓存：
   - 缓存命中率
   - 缓存大小
4. 优化建议：
   - 增加缓存TTL
   - 优化查询语句
   - 增加硬件资源

---

## 六、常见问题

### Q1: 如何修改默认密码？

**A**: 
1. 登录系统后，点击右上角用户名
2. 选择"个人设置"
3. 点击"修改密码"
4. 输入旧密码和新密码
5. 点击"保存"

### Q2: 如何添加新用户？

**A**:
1. 管理员登录系统
2. 进入"系统设置" → "用户管理"
3. 点击"新建用户"
4. 填写用户信息：
   - 用户名
   - 邮箱
   - 角色 (admin/operator/viewer)
5. 点击"保存"
6. 系统自动发送激活邮件

### Q3: 如何配置邮件通知？

**A**:
1. 进入"系统设置" → "通知设置"
2. 选择"邮件通知"
3. 填写SMTP配置：
   - SMTP服务器: smtp.example.com
   - 端口: 587
   - 用户名: your_email@example.com
   - 密码: your_password
   - 启用TLS: 是
4. 点击"测试连接"
5. 保存配置

### Q4: 如何备份数据？

**A**:
**自动备份**:
- 系统每天自动备份到 `/opt/backups/yl-monitor/`
- 保留最近10个备份

**手动备份**:
```bash
# 执行备份脚本
sudo ./scripts/deploy.sh backup
```

**数据恢复**:
```bash
# 从备份恢复
sudo ./scripts/deploy.sh rollback
```

### Q5: 如何扩展监控节点？

**A**:
1. 在新节点安装监控Agent
2. 配置Agent连接到主服务器
3. 在主服务器添加新节点
4. 配置监控项和告警规则

### Q6: 系统支持哪些数据库？

**A**:
- SQLite (默认，适合小规模)
- PostgreSQL (推荐，适合生产环境)
- MySQL (支持)

### Q7: 如何查看API文档？

**A**:
1. 访问 `http://0.0.0.0:8000/api/docs`
2. 或使用 Swagger UI 查看
3. 详细的API规范见 `docs/api-standard.md`

### Q8: 如何获取技术支持？

**A**:
- 查看在线文档: `docs/`
- 提交Issue到项目仓库
- 联系系统管理员

---

## 📞 联系与支持

**技术支持**: support@yl-monitor.com  
**文档中心**: https://docs.yl-monitor.com  
**社区论坛**: https://community.yl-monitor.com

---

**文档版本**: 1.0.0  
**最后更新**: 2026-02-10  
**维护团队**: YL-Monitor Team
