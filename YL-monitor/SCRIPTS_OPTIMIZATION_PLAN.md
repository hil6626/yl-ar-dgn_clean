# YL-Monitor è„šæœ¬ç®¡ç†é¡µé¢ä¼˜åŒ–æ–¹æ¡ˆ

## å·²å®Œæˆçš„åç«¯åŸºç¡€è®¾æ–½

### 1. è„šæœ¬è‡ªåŠ¨æ‰«æåˆ†ç±»ç³»ç»Ÿ (`app/services/scripts_scanner.py`)

**åŠŸèƒ½ï¼š**
- è‡ªåŠ¨æ‰«æ `scripts/` ç›®å½•ä¸‹çš„æ‰€æœ‰è„šæœ¬
- æŒ‰åŠŸèƒ½è‡ªåŠ¨åˆ†ç±»ä¸º 10 ä¸ªç±»åˆ«ï¼š
  - ğŸ” ç³»ç»Ÿç›‘æ§ (monitors/system)
  - ğŸŒ æœåŠ¡ç›‘æ§ (monitors/service)
  - ğŸ¥ ARç›‘æ§ (monitors/ar)
  - ğŸ§¹ èµ„æºä¼˜åŒ– (optimizers/resource)
  - âš¡ æœåŠ¡ä¼˜åŒ– (optimizers/service)
  - ğŸ’¾ ç»´æŠ¤å¤‡ä»½ (maintenance/backup)
  - ğŸ¥ ç»´æŠ¤å¥åº· (maintenance/health)
  - ğŸ§½ ç»´æŠ¤æ¸…ç† (maintenance/cleanup)
  - ğŸš¨ å‘Šè­¦å¤„ç† (alerts)
  - ğŸ› ï¸ å·¥å…·è„šæœ¬ (utils)
  - ğŸ”§ æ ¸å¿ƒè„šæœ¬ (core)

**è‡ªåŠ¨æå–çš„å…ƒæ•°æ®ï¼š**
- è„šæœ¬åç§°ï¼ˆä»æ–‡ä»¶åæ™ºèƒ½è§£æï¼‰
- æè¿°ï¼ˆä»æ–‡æ¡£å­—ç¬¦ä¸²æå–ï¼‰
- å‚æ•°ä¿¡æ¯ï¼ˆä» argparse è§£æï¼‰
- æ ‡ç­¾ï¼ˆå…³é”®è¯è‡ªåŠ¨è¯†åˆ«ï¼‰
- è„šæœ¬ç±»å‹ï¼ˆPython/Shellï¼‰

### 2. è„šæœ¬å…ƒæ•°æ®ç®¡ç†å™¨ (`app/services/script_metadata.py`)

**åŠŸèƒ½ï¼š**
- ç®¡ç†è„šæœ¬æ‰§è¡Œå†å²è®°å½•
- è¿½è¸ªè„šæœ¬æ‰§è¡ŒçŠ¶æ€ï¼ˆç©ºé—²/è¿è¡Œä¸­/æˆåŠŸ/å¤±è´¥ï¼‰
- ç»Ÿè®¡æ‰§è¡Œæ¬¡æ•°ã€æˆåŠŸç‡
- æŒä¹…åŒ–å­˜å‚¨åˆ° JSON æ–‡ä»¶

### 3. WebSocket å®æ—¶æ¨é€ç³»ç»Ÿ (`app/ws/scripts_ws.py`)

**åŠŸèƒ½ï¼š**
- å®æ—¶æ¨é€è„šæœ¬æ‰§è¡Œè¿›åº¦
- å®æ—¶æ¨é€æ‰§è¡Œæ—¥å¿—
- æ”¯æŒå¤šå®¢æˆ·ç«¯åŒæ—¶ç›‘æ§
- å¿ƒè·³æ£€æµ‹ä¿æŒè¿æ¥

### 4. æ‰©å±•çš„ REST API (`app/routes/scripts.py`)

**æ–°å¢æ¥å£ï¼š**

| æ¥å£ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/v1/scripts/categories` | GET | è·å–æ‰€æœ‰åˆ†ç±» |
| `/api/v1/scripts?category={id}` | GET | æŒ‰åˆ†ç±»ç­›é€‰è„šæœ¬ |
| `/api/v1/scripts` | GET | è·å–æ‰€æœ‰è„šæœ¬ï¼ˆå¸¦çŠ¶æ€ï¼‰ |
| `/api/v1/scripts/batch-execute` | POST | æ‰¹é‡æ‰§è¡Œè„šæœ¬ |
| `/api/v1/scripts/{id}/execute` | POST | æ‰§è¡Œå•ä¸ªè„šæœ¬ |
| `/api/v1/scripts/{id}/history` | GET | è·å–æ‰§è¡Œå†å² |
| `/api/v1/scripts/statistics` | GET | è·å–æ‰§è¡Œç»Ÿè®¡ |
| `/ws/scripts` | WebSocket | å…¨å±€è„šæœ¬æ›´æ–° |
| `/ws/scripts/{id}` | WebSocket | ç‰¹å®šè„šæœ¬ç›‘æ§ |
| `/ws/execution/{id}` | WebSocket | æ‰§è¡Œæ—¥å¿—å®æ—¶æ¨é€ |

---

## å‰ç«¯é¡µé¢ä¼˜åŒ–å»ºè®®

### é¡µé¢å¸ƒå±€è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  YL-Monitor è„šæœ¬ç®¡ç†                                    [?] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [ğŸ” ç³»ç»Ÿç›‘æ§] [ğŸŒ æœåŠ¡ç›‘æ§] [ğŸ¥ ARç›‘æ§] [ğŸ§¹ èµ„æºä¼˜åŒ–] [âš¡ æœåŠ¡ä¼˜åŒ–] â”‚
â”‚  [ğŸ’¾ ç»´æŠ¤å¤‡ä»½] [ğŸ¥ ç»´æŠ¤å¥åº·] [ğŸš¨ å‘Šè­¦å¤„ç†] [ğŸ› ï¸ å·¥å…·] [ğŸ”§ æ ¸å¿ƒ] [å…¨éƒ¨] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ ğŸ” CPUç›‘æ§   â”‚ â”‚ ğŸ” å†…å­˜ç›‘æ§  â”‚ â”‚ ğŸ” ç£ç›˜æ£€æŸ¥  â”‚           â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚           â”‚
â”‚  â”‚ çŠ¶æ€: âœ…ç©ºé—² â”‚ â”‚ çŠ¶æ€: â³è¿è¡Œ â”‚ â”‚ çŠ¶æ€: âœ…ç©ºé—² â”‚           â”‚
â”‚  â”‚ æ‰§è¡Œ: 12æ¬¡  â”‚ â”‚ æ‰§è¡Œ: 8æ¬¡   â”‚ â”‚ æ‰§è¡Œ: 15æ¬¡  â”‚           â”‚
â”‚  â”‚             â”‚ â”‚             â”‚ â”‚             â”‚           â”‚
â”‚  â”‚ [â–¶ æ‰§è¡Œ] [ğŸ“Šå†å²] [âš™ï¸è®¾ç½®] â”‚ â”‚ [â¹ åœæ­¢] [ğŸ“Šå†å²] â”‚ â”‚ [â–¶ æ‰§è¡Œ] [ğŸ“Šå†å²] â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ‰¹é‡æ“ä½œ: [â–¡ å…¨é€‰] [â–¶ æ‰§è¡Œé€‰ä¸­] [â¹ åœæ­¢é€‰ä¸­] [ğŸ—‘ï¸ æ¸…é™¤å†å²]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è„šæœ¬å¡ç‰‡ç»„ä»¶åŠŸèƒ½

æ¯ä¸ªè„šæœ¬å¡ç‰‡åº”åŒ…å«ï¼š
1. **å›¾æ ‡ + åç§°** - åˆ†ç±»å›¾æ ‡ + è„šæœ¬åç§°
2. **æè¿°** - è„šæœ¬åŠŸèƒ½ç®€ä»‹
3. **çŠ¶æ€æŒ‡ç¤ºå™¨** - é¢œè‰²æ ‡è¯†ï¼ˆç»¿è‰²=ç©ºé—²/æˆåŠŸï¼Œé»„è‰²=è¿è¡Œä¸­ï¼Œçº¢è‰²=å¤±è´¥ï¼‰
4. **æ‰§è¡Œç»Ÿè®¡** - æ‰§è¡Œæ¬¡æ•°ã€æˆåŠŸç‡
5. **æ“ä½œæŒ‰é’®**ï¼š
   - â–¶ æ‰§è¡Œ - å¯åŠ¨è„šæœ¬
   - â¹ åœæ­¢ - åœæ­¢è¿è¡Œä¸­çš„è„šæœ¬
   - ğŸ“Š å†å² - æŸ¥çœ‹æ‰§è¡Œå†å²
   - âš™ï¸ è®¾ç½® - é…ç½®è½®è¯¢ç­‰å‚æ•°

### æ‰§è¡Œè¿›åº¦æ¨¡æ€æ¡†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ‰§è¡Œè„šæœ¬: CPUç›‘æ§                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¿›åº¦: [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘] 45%          â”‚
â”‚                                         â”‚
â”‚ æ—¥å¿—è¾“å‡º:                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ 2024-01-15 10:30:01 å¼€å§‹æ‰§è¡Œ...      â”‚ â”‚
â”‚ â”‚ 2024-01-15 10:30:02 é‡‡é›†CPUæ•°æ®...   â”‚ â”‚
â”‚ â”‚ 2024-01-15 10:30:03 åˆ†æä¸­...        â”‚ â”‚
â”‚ â”‚ ...                                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                         â”‚
â”‚ çŠ¶æ€: è¿è¡Œä¸­ | è€—æ—¶: 3.2ç§’               â”‚
â”‚                                         â”‚
â”‚          [â¹ åœæ­¢]  [âœ• å…³é—­]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å‰ç«¯å®ç°å»ºè®®

### éœ€è¦åˆ›å»ºçš„å‰ç«¯æ–‡ä»¶

1. **`static/js/scripts-manager.js`**
   - è„šæœ¬ç®¡ç†å™¨ä¸»é€»è¾‘
   - åˆ†ç±»ç­›é€‰
   - æ‰¹é‡æ“ä½œ

2. **`static/js/script-card.js`**
   - è„šæœ¬å¡ç‰‡ç»„ä»¶
   - çŠ¶æ€æ›´æ–°
   - æ“ä½œå¤„ç†

3. **`static/js/execution-modal.js`**
   - æ‰§è¡Œè¿›åº¦æ¨¡æ€æ¡†
   - WebSocket è¿æ¥
   - å®æ—¶æ—¥å¿—æ˜¾ç¤º

4. **ä¿®æ”¹ `templates/scripts.html`**
   - æ·»åŠ åˆ†ç±»å¯¼èˆªæ 
   - è„šæœ¬å¡ç‰‡ç½‘æ ¼å¸ƒå±€
   - æ‰¹é‡æ“ä½œå·¥å…·æ 

### å…³é”®æŠ€æœ¯å®ç°

```javascript
// WebSocket è¿æ¥ç¤ºä¾‹
class ScriptsWebSocket {
    constructor() {
        this.ws = new WebSocket('ws://127.0.0.1:5500/ws/scripts');
        this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            this.handleUpdate(data);
        };
    }
    
    handleUpdate(data) {
        if (data.type === 'script_update') {
            // æ›´æ–°è„šæœ¬å¡ç‰‡çŠ¶æ€
            updateScriptCard(data.script_id, data.data);
        } else if (data.type === 'execution_update') {
            // æ›´æ–°æ‰§è¡Œè¿›åº¦
            updateExecutionProgress(data);
        } else if (data.type === 'log') {
            // è¿½åŠ æ—¥å¿—
            appendLog(data.message);
        }
    }
}
```

---

## å®æ–½ä¼˜å…ˆçº§å»ºè®®

### Phase 1: åŸºç¡€åŠŸèƒ½ï¼ˆ1-2å¤©ï¼‰
- [ ] æ”¹é€  `scripts.html` æ·»åŠ åˆ†ç±»å¯¼èˆª
- [ ] åˆ›å»ºè„šæœ¬å¡ç‰‡ç»„ä»¶
- [ ] å®ç°å•è„šæœ¬æ‰§è¡ŒåŠŸèƒ½
- [ ] åŸºç¡€çŠ¶æ€æ˜¾ç¤º

### Phase 2: å®æ—¶ç›‘æ§ï¼ˆ1-2å¤©ï¼‰
- [ ] å®ç° WebSocket å®¢æˆ·ç«¯
- [ ] åˆ›å»ºæ‰§è¡Œè¿›åº¦æ¨¡æ€æ¡†
- [ ] å®æ—¶æ—¥å¿—æ˜¾ç¤º
- [ ] æ‰§è¡Œå†å²æŸ¥çœ‹

### Phase 3: é«˜çº§åŠŸèƒ½ï¼ˆ2-3å¤©ï¼‰
- [ ] æ‰¹é‡æ“ä½œåŠŸèƒ½
- [ ] å®šæ—¶ä»»åŠ¡è®¾ç½®
- [ ] æ‰§è¡Œç»Ÿè®¡æŠ¥è¡¨
- [ ] æœç´¢å’Œç­›é€‰ä¼˜åŒ–

---

## API ä½¿ç”¨ç¤ºä¾‹

### è·å–è„šæœ¬åˆ†ç±»
```bash
curl http://127.0.0.1:5500/api/v1/scripts/categories
```

### è·å–ç³»ç»Ÿç›‘æ§ç±»è„šæœ¬
```bash
curl "http://127.0.0.1:5500/api/v1/scripts?category=system-monitor"
```

### æ‰§è¡Œè„šæœ¬
```bash
curl -X POST http://127.0.0.1:5500/api/v1/scripts/system-monitor_cpu_usage_monitor/execute
```

### æ‰¹é‡æ‰§è¡Œ
```bash
curl -X POST http://127.0.0.1:5500/api/v1/scripts/batch-execute \
  -H "Content-Type: application/json" \
  -d '{"script_ids": ["system-monitor_cpu_usage_monitor", "system-monitor_memory_usage_monitor"], "parallel": true}'
```

---

## æ€»ç»“

åç«¯å·²å®Œå…¨å°±ç»ªï¼Œæä¾›äº†ï¼š
- âœ… è‡ªåŠ¨è„šæœ¬æ‰«æå’Œåˆ†ç±»
- âœ… å®Œæ•´çš„ REST API
- âœ… WebSocket å®æ—¶æ¨é€
- âœ… æ‰§è¡Œå†å²è¿½è¸ª
- âœ… æ‰¹é‡æ‰§è¡Œæ”¯æŒ

å‰ç«¯éœ€è¦å®ç°ï¼š
- ğŸ”„ åˆ†ç±»å¯¼èˆªç•Œé¢
- ğŸ”„ è„šæœ¬å¡ç‰‡ç»„ä»¶
- ğŸ”„ æ‰§è¡Œè¿›åº¦ç›‘æ§
- ğŸ”„ æ‰¹é‡æ“ä½œå·¥å…·æ 

**å»ºè®®ä¸‹ä¸€æ­¥ï¼š** æˆ‘å¯ä»¥å¸®æ‚¨å®ç°å‰ç«¯é¡µé¢æ”¹é€ ï¼Œæˆ–è€…æ‚¨å¯ä»¥æ ¹æ®ä¸Šè¿°æ–¹æ¡ˆè‡ªè¡Œå¼€å‘å‰ç«¯éƒ¨åˆ†ã€‚
